<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Safe Space</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&family=Cinzel:wght@700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg viewBox='0 0 100 100' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M50 15C30 15 10 30 10 60C10 85 25 95 50 95C75 95 90 85 90 60C90 30 70 15 50 15Z' fill='%23FFFFFF' stroke='%23E0E0E0' stroke-width='3'/%3E%3Ccircle cx='35' cy='55' r='4' fill='%235C5552'/%3E%3Ccircle cx='65' cy='55' r='4' fill='%235C5552'/%3E%3Ccircle cx='28' cy='62' r='3' fill='%23FFD1DC' opacity='0.8'/%3E%3Ccircle cx='72' cy='62' r='3' fill='%23FFD1DC' opacity='0.8'/%3E%3C/svg%3E">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&display=swap" rel="stylesheet">

    <style>
        /* --- ğŸ¨ æ ¸å¿ƒè¦–è¦ºè®Šæ•¸ (æ—¥å¤œåˆ‡æ›ç³»çµ±) --- */
        :root {
            /* æ—¥é–“æ¨¡å¼ (é è¨­) */
            --primary: #7A9F6E;       /* æŠ¹èŒ¶ç¶  */
            --primary-dark: #58754F;
            --primary-light: #EBF2EA;
            --bg: #FCFAF7;            /* ç±³ç™½ */
            --card-bg: #FFFFFF;
            --text-main: #5C5552;     /* æ·±æš–ç° */
            --text-sub: #9E9894;
            --accent-warm: #D67D68;
            --radius-box: 24px;
            --radius-btn: 16px;
            --shadow-soft: 0 8px 20px rgba(122, 159, 110, 0.15);
            --glass: rgba(255, 255, 255, 0.90);
            --border-color: rgba(0,0,0,0.05);
            --pet-glow: drop-shadow(0 4px 6px rgba(0,0,0,0.15)); /* éºµåœ˜é™°å½± */
        }

        /* ğŸŒ™ æ·±è‰²æ¨¡å¼ (æº«æš–çš„æ·±å¤œå¯å¯è‰²) */
        body.dark-mode {
            --primary: #9BC58B;       /* äº®ä¸€é»çš„ç¶ ï¼Œå°æ¯”æ‰å¤  */
            --primary-dark: #BCE0AF;
            --primary-light: #3D3A37; /* æ·±å¡å…¶èƒŒæ™¯ */
            --bg: #2C2927;            /* æ·±å’–å•¡é»‘ */
            --card-bg: #383533;       /* ç¨å¾®äº®ä¸€é»çš„ç°è¤ */
            --text-main: #EDE8E4;     /* æš–ç™½ */
            --text-sub: #ACA59F;      /* æš–ç° */
            --shadow-soft: 0 8px 20px rgba(0, 0, 0, 0.4);
            --glass: rgba(44, 41, 39, 0.90);
            --border-color: rgba(255,255,255,0.1);
            --pet-glow: drop-shadow(0 0 10px rgba(255, 255, 255, 0.2)); /* å¤œæ™šç™¼å…‰ */
        }

        body {
            font-family: "Zen Maru Gothic", sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 24px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            line-height: 1.6;
            -webkit-tap-highlight-color: transparent;
            /* é—œéµï¼šé è¨­éš±è—æ²è»¸ï¼Œç­‰ Splash çµæŸæ‰æ‰“é–‹ */
            overflow: hidden; 
            transition: background-color 0.5s, color 0.5s;
        }

        /* --- ğŸ¬ å•Ÿå‹•ç•«é¢ (å‹•æ…‹æ•˜äº‹ç‰ˆ) --- */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--bg); z-index: 9999;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            transition: opacity 0.8s ease-out;
            /* é˜²æ­¢æ‰‹æ©Ÿæ»‘å‹•çœ‹åˆ°å¾Œé¢ */
            touch-action: none; 
        }
        
        .splash-content { text-align: center; position: relative; }

        .splash-logo-container {
            width: 140px; height: 140px; margin: 0 auto 30px auto;
            position: relative;
            /* 1. éºµåœ˜æ…¢æ…¢é€²ä¾† (å¾ä¸Šæ–¹é™è½) */
            animation: doughEnter 2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            opacity: 0; /* åˆå§‹éš±è— */
        }

        /* ç¦ªæ„éºµåœ˜ */
        .zen-dough {
            width: 100%; height: 100%;
            /* 2. é€²å ´å¾Œæ¥çºŒå‘¼å¸å‹•ç•« */
            animation: deepBreathe 6s ease-in-out infinite 2s; /* å»¶é²2ç§’ç­‰é€²å ´å®Œ */
            filter: var(--pet-glow);
        }

        .splash-title {
            font-size: 1.8rem; font-weight: 900; color: var(--primary);
            letter-spacing: 2px; margin-bottom: 5px;
            /* 3. æ¨™é¡Œæ…¢æ…¢å‡ºç¾ */
            opacity: 0;
            animation: fadeInUp 1.5s ease-out 1.5s forwards;
        }
        .splash-subtitle {
            font-size: 0.9rem; color: var(--text-sub); font-weight: 500;
            margin-bottom: 50px; opacity: 0;
            animation: fadeInUp 1.5s ease-out 1.8s forwards;
        }

        .start-btn {
            font-size: 1rem; color: white; font-weight: 700;
            padding: 14px 40px; 
            background: var(--primary);
            border: none;
            border-radius: 50px; cursor: pointer;
            box-shadow: 0 5px 15px rgba(122, 159, 110, 0.3);
            transition: all 0.3s;
            letter-spacing: 1px;
            opacity: 0;
            /* 4. æŒ‰éˆ•æ·¡å…¥ + æ–å‹•ä¸€ä¸‹ */
            animation: fadeInUp 1s ease-out 2.5s forwards, shakeBtn 0.5s ease-in-out 3s;
        }
        .start-btn:active { transform: scale(0.95); }

        /* å‹•ç•«å®šç¾© */
        @keyframes doughEnter {
            0% { transform: translateY(-50px) scale(0.8); opacity: 0; }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }
        @keyframes deepBreathe {
            0%, 100% { transform: scale(1) translateY(0); }
            50% { transform: scale(1.05) translateY(-5px); }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes shakeBtn {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
        }


        /* --- ğŸ  ä¸»ä»‹é¢ --- */
        /* æ¨™é¡Œé¡è‰²èˆ‡å•Ÿå‹•é åŒæ­¥ var(--primary) */
        header { text-align: center; margin-bottom: 24px; margin-top: 20px; width: 100%; max-width: 500px;}
        h1 { font-weight: 900; font-size: 2rem; margin: 0; color: var(--primary); letter-spacing: 1px; transition: color 0.5s; }
        p.subtitle { font-size: 0.95rem; color: var(--text-sub); margin-top: 5px; font-weight: 500; }

        /* --- ğŸ” æœå°‹æ¬„ --- */
        .search-container { width: 100%; max-width: 500px; margin-bottom: 24px; }
        #search-input {
            width: 100%; padding: 16px 24px; border-radius: 50px;
            border: 2px solid transparent; background: var(--card-bg);
            font-size: 1rem; font-family: "Zen Maru Gothic", sans-serif; font-weight: 700;
            color: var(--text-main); outline: none;
            box-shadow: var(--shadow-soft); box-sizing: border-box;
            transition: all 0.3s;
        }
        #search-input:focus { border-color: var(--primary); }
        #search-input::placeholder { color: var(--text-sub); font-weight: 500; opacity: 0.7; }

        /* --- ğŸš‘ æƒ…ç·’å¿«ç¯©å€ --- */
        .triage-section {
            width: 100%; max-width: 500px;
            background: var(--primary-light);
            padding: 24px; padding-bottom: 30px;
            border-radius: var(--radius-box);
            margin-bottom: 32px;
            position: relative;
            box-sizing: border-box;
            box-shadow: inset 0 0 0 2px rgba(255,255,255,0.1); /* å¾®èª¿æ·±è‰²æ¨¡å¼ä¸‹çš„é‚Šæ¡† */
            transition: background 0.5s;
        }
        .triage-title { 
            font-size: 1.1rem; margin-bottom: 16px; 
            color: var(--primary-dark); font-weight: 900; text-align: center; 
        }

        .mood-grid {
            display: grid; grid-template-columns: 1fr 1fr 1fr; 
            gap: 12px; margin-bottom: 10px;
        }
        
        .mood-card {
            background: var(--card-bg); border: 3px solid transparent; 
            color: var(--text-main);
            padding: 10px 5px; border-radius: var(--radius-btn);
            cursor: pointer; transition: all 0.2s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 4px 0 rgba(0,0,0,0.05);
            height: 110px;
        }
        .mood-card:active { transform: translateY(4px); box-shadow: none; }
        .mood-card.active {
            background: var(--card-bg);
            transform: translateY(2px);
            box-shadow: inset 0 3px 5px rgba(0,0,0,0.2);
        }
        
        .mood-icon-svg { width: 60px; height: 60px; margin-bottom: 5px; }
        .mood-label { font-size: 0.85rem; font-weight: 700; line-height: 1.2; text-align: center;}

        /* --- ğŸ› ï¸ å·¥å…·ç®±åˆ—è¡¨ --- */
        .toolbox-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 16px;
            width: 100%; max-width: 500px; padding-bottom: 100px;
        }
        .feature-card {
            background: var(--card-bg); border-radius: var(--radius-box);
            padding: 20px 10px; display: flex; flex-direction: column;
            align-items: center; justify-content: flex-start; text-align: center;
            box-shadow: var(--shadow-soft); cursor: pointer;
            transition: transform 0.2s; height: 160px; position: relative;
            overflow: hidden; 
        }
        .feature-card:active { transform: scale(0.96); }
        
        .card-visual { 
            width: 90px; height: 90px; 
            margin-bottom: 10px; 
            position: relative;
        }
        .feature-svg { width: 100%; height: 100%; filter: var(--pet-glow); }

        .card-title { font-size: 1.1rem; color: var(--text-main); font-weight: 700; margin-bottom: 2px;}
        .card-tag { font-size: 0.8rem; color: var(--text-sub); font-weight: 500; }
        
        .card-fav-btn {
            position: absolute; top: 10px; right: 10px;
            font-size: 1.2rem; color: #EEE; padding: 8px;
            z-index: 5; transition: color 0.3s;
        }
        /* æ·±è‰²æ¨¡å¼ä¸‹æ„›å¿ƒåº•è‰²èª¿æ•´ */
        body.dark-mode .card-fav-btn { color: #555; }
        .card-fav-btn.is-active { color: var(--accent-warm) !important; }

        .fav-fab-container { position: absolute; bottom: -15px; right: 15px; z-index: 10; }
        .fav-fab {
            width: 70px; height: 70px;
            background-color: var(--card-bg); color: var(--accent-warm);
            border-radius: 50%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 6px 15px rgba(122, 159, 110, 0.2);
            cursor: pointer; transition: all 0.2s;
            border: 3px solid var(--card-bg);
        }
        .fav-fab:active { transform: scale(0.9); }
        .fav-fab.active { background-color: var(--accent-warm); color: white; transform: scale(0.95); }
        .fav-icon { font-size: 1.4rem; line-height: 1; margin-bottom: 2px; }
        .fav-text { font-size: 0.75rem; font-weight: 900; line-height: 1; }

        /* --- ğŸ“± Modal --- */
        #active-feature-container {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg); z-index: 1000;
            display: none; flex-direction: column; padding: 24px;
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-header { display: flex; justify-content: flex-end; margin-bottom: 40px; }
        .close-btn {
            padding: 10px 20px; background: var(--primary-light); border-radius: 20px;
            border: none; cursor: pointer; font-family: "Zen Maru Gothic", sans-serif;
            font-weight: 700; color: var(--text-main);
        }

        /* --- âš™ï¸ è¨­å®šé½’è¼ª (æ›´æ˜é¡¯ç²¾ç·») --- */
        .settings-fab {
            position: fixed; bottom: 30px; left: 20px; z-index: 2000;
            width: 60px; height: 60px; /* åŠ å¤§ */
            background: var(--card-bg); 
            backdrop-filter: blur(10px);
            border-radius: 50%;
            /* åŠ å¼·é™°å½±èˆ‡é‚Šæ¡†å…‰æ¾¤ */
            box-shadow: 0 8px 25px rgba(0,0,0,0.15), 0 0 0 1px rgba(255,255,255,0.5);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.3s;
        }
        .settings-fab:hover { transform: scale(1.05); }
        .settings-fab:active { transform: rotate(90deg) scale(0.95); }
        .gear-icon { width: 32px; height: 32px; fill: var(--text-main); }

        /* --- âš™ï¸ è¨­å®š Modal (æº«æš–ç£¨ç ‚è³ªæ„Ÿ) --- */
        #settings-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4); z-index: 3000;
            display: none; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.3s;
        }
        #settings-modal.show { opacity: 1; }
        .settings-content {
            background: var(--glass);
            width: 85%; max-width: 360px;
            border-radius: var(--radius-box);
            padding: 24px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            backdrop-filter: blur(25px);
            border: 1px solid var(--border-color);
            transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-height: 80vh; overflow-y: auto;
        }
        #settings-modal.show .settings-content { transform: scale(1); }
        
        .settings-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid var(--border-color); padding-bottom: 10px; }
        .settings-title { font-size: 1.3rem; font-weight: 900; color: var(--text-main); }
        
        .setting-section-title {
            font-size: 0.85rem; font-weight: 900; color: var(--primary);
            margin-top: 15px; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px;
        }

        .setting-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px 0; border-bottom: 1px solid var(--border-color);
        }
        .setting-item:last-child { border-bottom: none; }
        
        .st-label { font-weight: 700; color: var(--text-main); display: flex; align-items: center; gap: 10px; font-size: 0.95rem; }
        .st-icon { font-size: 1.2rem; width: 25px; text-align: center; }
        
        .setting-input {
            border: 2px solid var(--border-color); background: rgba(255,255,255,0.1);
            padding: 8px 12px; border-radius: 12px;
            font-family: inherit; font-weight: 700; color: var(--text-main);
            width: 120px; text-align: right; outline: none; transition: border 0.3s;
        }
        .setting-input:focus { border-color: var(--primary); background: var(--card-bg); }

        .toggle-switch {
            width: 46px; height: 26px; background: #DDD;
            border-radius: 20px; position: relative; cursor: pointer; transition: background 0.3s;
        }
        /* æ·±è‰²æ¨¡å¼ä¸‹çš„ Toggle èƒŒæ™¯è®Šæ·±ä¸€é» */
        body.dark-mode .toggle-switch { background: #555; }
        
        .toggle-switch::after {
            content: ''; position: absolute; top: 3px; left: 3px;
            width: 20px; height: 20px; background: white;
            border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: left 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .toggle-switch.active { background: var(--primary); }
        .toggle-switch.active::after { left: 23px; }

        .btn-action {
            width: 100%; padding: 12px; background: var(--card-bg);
            border: 1px solid var(--border-color); border-radius: 12px;
            font-weight: 700; color: var(--text-main); margin-top: 5px;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
            transition: background 0.2s;
        }
        .btn-action:active { filter: brightness(0.95); }
        .danger-btn { color: #FF6B6B; border-color: #FF6B6B; margin-top: 10px; background: transparent; }


        /* --- â˜ï¸ éºµåœ˜ç²¾éˆæœ¬é«” --- */
        #spirit-pet {
            position: fixed; width: 80px; height: 80px; z-index: 2001;
            cursor: grab; touch-action: none; display: none;
            -webkit-tap-highlight-color: transparent;
        }
        #spirit-pet:active { cursor: grabbing; }
        #spirit-pet.auto-moving { transition: top 3s ease-in-out, left 3s ease-in-out; }
        .pet-svg-body {
            width: 100%; height: 100%;
            filter: var(--pet-glow); /* æ”¯æ´å¤œé–“ç™¼å…‰ */
            animation: petFloat 4s ease-in-out infinite;
        }
        @keyframes petFloat {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-6px) scale(1.03); }
        }
        .pet-shake { animation: shake 0.4s ease-in-out; }
        @keyframes shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            50% { transform: rotate(10deg); }
            75% { transform: rotate(-5deg); }
            100% { transform: rotate(0deg); }
        }
        .pet-speech-bubble {
            position: absolute; top: -60px; left: 50%;
            transform: translateX(-50%) scale(0);
            background: var(--card-bg); padding: 10px 16px; border-radius: 18px;
            font-size: 0.9rem; color: var(--text-main); font-weight: 700;
            white-space: nowrap; box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            opacity: 0; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none; border: 2px solid var(--primary-light); z-index: 2002;
        }
        .pet-speech-bubble::after {
            content: ''; position: absolute; bottom: -8px; left: 50%;
            transform: translateX(-50%); border-width: 8px 8px 0; border-style: solid;
            border-color: var(--card-bg) transparent transparent transparent;
        }
        .pet-speech-bubble.show { transform: translateX(-50%) scale(1); opacity: 1; top: -75px; }
        /* é¡æ–‡å­—å°ˆç”¨å­—é«” (å¼·åˆ¶ Arial) */
        .kaomoji { font-family: "Arial", sans-serif; font-weight: normal; display: inline-block; }

        /* --- SVG å‹•ç•«é—œéµå½±æ ¼ --- */
        @keyframes blink { 0%, 90%, 100% { transform: scaleY(1); } 95% { transform: scaleY(0.1); } }
        @keyframes sway { 0%, 100% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } }
        @keyframes breathe { 0%, 100% { transform: scale(0.95); } 50% { transform: scale(1.05); } }
        @keyframes floatItem { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes spinEye { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes tearDrop { 0% { opacity: 0; transform: translateY(0); } 50% { opacity: 1; } 100% { opacity: 0; transform: translateY(10px); } }
        @keyframes panicWave { 0%, 100% { transform: rotate(-20deg); } 50% { transform: rotate(20deg); } }
        @keyframes muscleFlex { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes lidOpen { 0%, 100% { transform: rotate(0); } 50% { transform: rotate(-20deg) translateY(-5px); } }
        @keyframes conveyorMove { 0% { transform: translateX(0); opacity: 1; } 100% { transform: translateX(40px); opacity: 0; } }
/* === DBT å¡ç‰‡å°ˆå±¬æ¨£å¼ === */

/* 1. é è¨­æ¨¡å¼ (äº®è‰²) */
.dbt-card-container {
    background: #FFF5EB; /* åŸæœ¬çš„æš–æ©˜ç™½ */
    padding: 20px;
    border-radius: 15px;
    text-align: center;
    animation: fadeIn 0.5s;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
}

.dbt-text {
    font-size: 1.2rem;
    color: #555; /* æ·±ç°å­— */
    min-height: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    line-height: 1.6;
}

.dbt-btn {
    background: #FF9F43;
    color: white;
    border: none;
    padding: 12px 30px;
    border-radius: 50px;
    font-size: 1rem;
    cursor: pointer;
    margin-top: 20px;
    box-shadow: 0 4px 10px rgba(255, 159, 67, 0.4);
    transition: transform 0.1s;
}

/* 2. æ·±è‰²æ¨¡å¼ (Dark Mode) - è‡ªå‹•è¦†è“‹ä¸Šé¢çš„è¨­å®š */
body.dark-mode .dbt-card-container {
    background: #2d2d2d; /* æ·±ç°åº• */
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    border: 1px solid #444;
}

body.dark-mode .dbt-text {
    color: #e0e0e0; /* æ·ºç°å­— */
}

/* æŒ‰éˆ•åœ¨æ·±è‰²æ¨¡å¼é€šå¸¸ä¸ç”¨è®Šï¼Œæˆ–è€…ä½ å¯ä»¥æ”¹æˆç¨å¾®äº®ä¸€é»çš„æ©˜è‰² */
/* --- è§£ç­”ä¹‹æ›¸å°ˆç”¨æ¨£å¼ (Namespace: .ab-) --- */
/* --- è§£ç­”ä¹‹æ›¸ (Answer Book) : çµ•å°é®è”½ä¿®æ­£ç‰ˆ --- */

/* 1. èˆå°èˆ‡æ‡¸æµ® */
.ab-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    min-height: 600px;
    perspective: 2500px;
    overflow: visible;
}

@keyframes floatBook {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-12px); }
}

/* 2. æ›¸æœ¬å®¹å™¨ (Book) */
.ab-book {
    position: relative;
    /* é€™æ˜¯æ•´å€‹æ›¸çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯ã€Œå°é¢ã€çš„å¤§å° */
    width: 280px;  
    height: 400px; 
    transform-style: preserve-3d;
    transition: transform 1.2s cubic-bezier(0.2, 0.8, 0.2, 1);
    
    /* é è¨­é–‰åˆè¦–è§’ï¼šç¨å¾®å´ä¸€é» */
    transform: rotateY(-30deg) rotateX(10deg);
    animation: floatBook 6s ease-in-out infinite;
    cursor: pointer;
}

.ab-book.is-open {
    /* æ‰“é–‹æ™‚è½‰æ­£ä¸¦å³ç§» */
    transform: rotateY(-5deg) rotateX(0deg) translateX(80px);
}

/* 3. æ›¸è„Š (Spine) */
.ab-spine {
    position: absolute;
    top: 0; bottom: 0;
    left: -32px; /* æ›¸è„Šå¯¬åº¦ */
    width: 32px;
    background-color: #16213e; /* æ·±è— */
    transform-origin: right;
    transform: rotateY(-90deg);
    
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 5; /* ä½æ–¼å°é¢ */
    
    border: 1px solid rgba(0,0,0,0.2);
    box-shadow: inset 10px 0 20px rgba(0,0,0,0.6);
    border-radius: 4px 0 0 4px;
}

.ab-spine-text {
    writing-mode: vertical-rl;
    transform: rotate(180deg);
    color: #c9a227;
    font-family: 'Cinzel', serif;
    font-size: 1rem;
    letter-spacing: 4px;
    opacity: 0.8;
}

/* 4. å°é¢ç¾¤çµ„ (Cover Group) - é€™æ˜¯ã€Œé–€ã€ */
.ab-cover-group {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    transform-origin: left;
    transform-style: preserve-3d;
    transition: transform 1.8s cubic-bezier(0.645, 0.045, 0.355, 1);
    
    /* ğŸ”¥ é—œéµä¿®æ­£ï¼šå±¤ç´šè¨­ç‚ºæœ€é«˜ï¼Œç¢ºä¿è“‹ä½å…§é  */
    z-index: 50; 
}

.ab-book.is-open .ab-cover-group {
    transform: rotateY(-155deg);
}

/* 4.1 å°é¢æ­£é¢ */
.ab-cover-front {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: #1a1a2e; /* åˆå¤œè— */
    /* æ˜Ÿç©ºç´‹ç† */
    background-image: 
        radial-gradient(circle at 50% 50%, rgba(255,255,255,0.05) 1px, transparent 1px),
        linear-gradient(45deg, #16213e 25%, transparent 25%, transparent 75%, #16213e 75%, #16213e);
    background-size: 20px 20px, 40px 40px;
    
    backface-visibility: hidden; /* ç¢ºä¿èƒŒé¢ä¸å¹²æ“¾ */
    border-radius: 0 8px 8px 0;
    border: 2px solid #0f1524;
    box-shadow: inset 0 0 0 5px #c9a227; /* é‡‘æ¡† */
    
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #c9a227;
}

/* 4.2 å°é¢å…§é¢ (ç¿»é–‹å¾Œå·¦å´) */
.ab-cover-back {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: #1a1a2e;
    transform: rotateY(180deg);
    backface-visibility: hidden;
    border-radius: 8px 0 0 8px;
    box-shadow: inset 0 0 0 3px rgba(201, 162, 39, 0.3);
    
    display: flex;
    align-items: center;
    justify-content: center;
}
/* å…§é¢çš„ç´™å¼µç´‹ç† (è£é£¾ç”¨) */
.ab-cover-back::after {
    content: '';
    width: 92%; height: 94%;
    background-color: #fdfbf7;
    opacity: 0.03; 
}

/* 5. å…§é  (Pages) - é€™å°±æ˜¯åŸæœ¬éœ²å‡ºä¾†çš„ç½ªé­ç¦é¦– */
.ab-pages {
    position: absolute;
    /* ğŸ”¥ é—œéµä¿®æ­£ï¼šè®“å…§é æ¯”å°é¢å°ï¼Œä¸¦å¾€ä¸­é–“ç¸® */
    top: 10px; 
    bottom: 10px;
    left: 2px;  /* ç¨å¾®é›¢é–‹æ›¸è„Šä¸€é»é» */
    right: 15px; /* å³é‚Šç•™ç©ºéš™ï¼Œè®“å°é¢è“‹å¾—ä½ */
    /* ä¸è¨­å®š width/heightï¼Œæ”¹ç”¨ top/bottom/right ç´„æŸ */
    
    background-color: #fdfbf7;
    z-index: 1; /* ğŸ”¥ è¨­ç‚ºæœ€ä½å±¤ç´šï¼Œä¿è­‰è¢«å°é¢å£“æ­» */
    
    /* 500é åšåº¦æ¨¡æ“¬ (åªé¡¯ç¤ºåœ¨å³å´å’Œä¸‹å´) */
    box-shadow: 
        inset 10px 0 20px rgba(0,0,0,0.1), /* å…§å‡¹ */
        /* å³å´åšåº¦å †ç–Š */
        1px 1px 0 #dcdcdc, 2px 2px 0 #dcdcdc, 3px 3px 0 #dcdcdc,
        4px 4px 0 #dcdcdc, 5px 5px 0 #dcdcdc, 6px 6px 0 #dcdcdc,
        7px 7px 0 #dcdcdc, 8px 8px 0 #dcdcdc, 9px 9px 0 #dcdcdc,
        10px 10px 0 #dcdcdc, 11px 11px 0 #dcdcdc, 12px 12px 0 #dcdcdc,
        13px 13px 0 #dcdcdc, 14px 14px 0 #dcdcdc, 15px 15px 0 #dcdcdc,
        /* é™°å½± */
        20px 20px 30px rgba(0,0,0,0.5);

    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 20px;
    overflow: hidden; /* é˜²æ­¢æ–‡å­—æº¢å‡º */
}

/* æ›¸ç¸«æ¼¸å±¤ */
.ab-pages::before {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 30px;
    background: linear-gradient(to right, rgba(0,0,0,0.15), transparent);
    pointer-events: none;
}

/* 6. åœ–æ¨™èˆ‡æ–‡å­— (ä¿æŒç²¾ç·»è¨­è¨ˆ) */
.ab-star-icon {
    position: relative;
    width: 60px; height: 60px;
    margin-bottom: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.ab-star-icon::before, .ab-star-icon::after {
    content: ''; position: absolute; width: 100%; height: 100%;
    border: 1px solid #c9a227; transition: all 0.5s;
}
.ab-star-icon::before { transform: rotate(45deg); box-shadow: 0 0 10px rgba(201,162,39,0.3); }
.ab-star-center { width: 6px; height: 6px; background: #c9a227; border-radius: 50%; box-shadow: 0 0 15px #c9a227; }

.ab-content-box {
    opacity: 0;
    transition: opacity 1s ease 0.6s;
    transform: translateZ(0);
}
.ab-book.is-open .ab-content-box { opacity: 1; }

.ab-answer-text {
    font-family: 'Noto Serif TC', serif;
    font-size: 1.5rem;
    font-weight: 700;
    color: #333;
    line-height: 1.6;
}
.ab-en {
    display: block; font-family: 'Cinzel', serif; font-size: 0.8rem;
    color: #8b7d6b; margin-top: 15px; font-weight: 400; text-transform: uppercase;
}
.ab-cover-title-en { font-family: 'Cinzel', serif; font-size: 1.6rem; font-weight: 700; letter-spacing: 2px; margin-bottom: 10px; text-shadow: 0 2px 4px rgba(0,0,0,0.6); text-align: center; }
.ab-cover-title-zh { font-family: 'Noto Serif TC', serif; font-size: 0.9rem; letter-spacing: 2px; opacity: 0.8; }
.ab-hint { margin-top: 60px; font-size: 0.9rem; color: #888; opacity: 0.6; letter-spacing: 1px; }

/* ğŸŒ™ Dark Mode */
.dark-mode .ab-pages {
    background-color: #2b2b2b;
    box-shadow: 
        inset 10px 0 20px rgba(0,0,0,0.3),
        1px 1px 0 #3d3d3d, 2px 2px 0 #3d3d3d, 3px 3px 0 #3d3d3d,
        4px 4px 0 #3d3d3d, 5px 5px 0 #3d3d3d, 6px 6px 0 #3d3d3d,
        7px 7px 0 #3d3d3d, 8px 8px 0 #3d3d3d, 9px 9px 0 #3d3d3d,
        10px 10px 0 #3d3d3d, 11px 11px 0 #3d3d3d, 12px 12px 0 #3d3d3d,
        13px 13px 0 #3d3d3d, 14px 14px 0 #3d3d3d, 15px 15px 0 #3d3d3d,
        20px 20px 50px rgba(0,0,0,0.8);
}
.dark-mode .ab-answer-text { color: #e0e0e0; }
.dark-mode .ab-en { color: #aaa; }
/* ğŸŒ™ 8. Dark Mode (ç¶å®š APP è‡ªèº«çš„ class) */
/* å‡è¨­ä½ çš„ APP åœ¨ body æˆ–çˆ¶å±¤æœƒåŠ ä¸Š .dark-mode */
.dark-mode .ab-body {
    background-color: #2c2c2c; /* æ·±ç°è‰²ç´™å¼µ */
    /* åšåº¦é™°å½±ä¹Ÿè¦è®Šè‰² */
    box-shadow: 
        1px 1px 0 #444,
        2px 2px 0 #444,
        3px 3px 0 #444,
        4px 4px 0 #444,
        5px 5px 0 #444,
        6px 6px 0 #444,
        10px 10px 20px rgba(0,0,0,0.6);
}

.dark-mode .ab-answer-text {
    color: #e0e0e0; /* æ·ºè‰²æ–‡å­— */
}

.dark-mode .ab-en {
    color: #aaa;
}

.dark-mode .ab-cover-inside {
    background-color: #2b2b2b; /* å°é¢å…§å´ä¹Ÿè¦è®Šæ·± */
}
    </style>
</head>
<body>

    <div id="splash-screen">
        <div class="splash-content">
            <div class="splash-logo-container">
                <svg viewBox="0 0 100 100" fill="none" class="zen-dough">
                    <path d="M50 15C30 15 10 30 10 60C10 85 25 95 50 95C75 95 90 85 90 60C90 30 70 15 50 15Z" fill="#FFFFFF" stroke="#5C5552" stroke-width="2.5"/>
                    <circle cx="28" cy="62" r="3.5" fill="#FFD1DC" opacity="0.8"/>
                    <circle cx="72" cy="62" r="3.5" fill="#FFD1DC" opacity="0.8"/>
                    <path d="M28 55 Q35 58 42 55" stroke="#5C5552" stroke-width="2.5" fill="none" stroke-linecap="round"/>
                    <path d="M58 55 Q65 58 72 55" stroke="#5C5552" stroke-width="2.5" fill="none" stroke-linecap="round"/>
                    <path d="M45 68 Q50 71 55 68" stroke="#5C5552" stroke-width="2" fill="none" opacity="0.8"/>
                </svg>
            </div>
            <div class="splash-title">Safe Space</div>
            <div class="splash-subtitle">å±¬æ–¼ä½ çš„å¿ƒéˆé¿é¢¨æ¸¯</div>
            <button class="start-btn" id="splash-start-btn">é€²å…¥ç©ºé–“</button>
        </div>
    </div>

    <div class="settings-fab" onclick="openSettings()">
        <svg class="gear-icon" viewBox="0 0 24 24">
            <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L3.16 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.04.64.09.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
        </svg>
    </div>

    <div id="settings-modal" onclick="closeSettings(event)">
        <div class="settings-content">
            <div class="settings-header">
                <div class="settings-title">å€‹äººè¨­å®š</div>
                <button class="close-btn" style="padding: 5px 12px; font-size: 0.8rem;" onclick="toggleSettings()">âœ•</button>
            </div>

            <div class="setting-section-title">æˆ‘çš„æª”æ¡ˆ</div>
            <div class="setting-item">
                <div class="st-label"><span class="st-icon">âœï¸</span> ä½ çš„ç¨±å‘¼</div>
                <input type="text" id="nickname-input" class="setting-input" placeholder="æ—…äºº" maxlength="8">
            </div>

            <div class="setting-section-title">ç’°å¢ƒé«”é©—</div>
            
            <div class="setting-item">
                <div class="st-label"><span class="st-icon">ğŸŒ™</span> æº«æš–æ·±è‰²æ¨¡å¼</div>
                <div class="toggle-switch" id="setting-dark-toggle"></div>
            </div>

            <div class="setting-item">
                <div class="st-label"><span class="st-icon">ğŸµ</span> èƒŒæ™¯éŸ³æ¨‚</div>
                <div class="toggle-switch" id="setting-music-toggle"></div>
            </div>

            <div class="setting-item">
                <div class="st-label"><span class="st-icon">ğŸ”Š</span> äº’å‹•éŸ³æ•ˆ (SFX)</div>
                <div class="toggle-switch" id="setting-sfx-toggle"></div>
            </div>

            <div class="setting-item">
                <div class="st-label">
                    <span class="st-icon">
                        <svg viewBox="0 0 100 100" fill="none" style="width:22px;height:22px;vertical-align:middle;">
                            <path d="M50 15C30 15 10 30 10 60C10 85 25 95 50 95C75 95 90 85 90 60C90 30 70 15 50 15Z" fill="#FFFFFF" stroke="#5C5552" stroke-width="3"/>
                            <circle cx="35" cy="55" r="4" fill="#5C5552"/>
                            <circle cx="65" cy="55" r="4" fill="#5C5552"/>
                            <circle cx="28" cy="62" r="3" fill="#FFD1DC" opacity="0.8"/>
                            <circle cx="72" cy="62" r="3" fill="#FFD1DC" opacity="0.8"/>
                        </svg>
                    </span> 
                    éºµåœ˜ç²¾éˆ
                </div>
                <div class="toggle-switch" id="setting-pet-toggle"></div>
            </div>

            <div class="setting-item">
                <div class="st-label"><span class="st-icon">ğŸŒ</span> èªè¨€ / Language</div>
                <div style="font-size:0.8rem; font-weight:700; color:var(--primary);">ç¹é«”ä¸­æ–‡</div>
            </div>

            <div class="setting-section-title">ç³»çµ±</div>
            <button class="btn-action danger-btn" style="font-size:0.8rem;" onclick="resetAppData()">ğŸ—‘ï¸ é‡ç½®æ‰€æœ‰è³‡æ–™</button>

            <div style="margin-top:20px; padding-top:15px; border-top:1px solid var(--border-color);">
                <div style="font-size:0.7rem; color:var(--text-sub); text-align:center;">
                    Designed by æœæ™ºå¹³/æœçš®<br>
                    Safe Space v1.3
                </div>
            </div>
        </div>
    </div>

    <div id="spirit-pet">
        <div class="pet-speech-bubble" id="pet-speech">å˜¿å’»ï¼<span class="kaomoji">( >Ï‰&lt;)</span></div>
        <div class="pet-svg-body">
            <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M50 15C30 15 10 30 10 60C10 85 25 95 50 95C75 95 90 85 90 60C90 30 70 15 50 15Z" fill="#FFFFFF" stroke="#E0E0E0" stroke-width="3"/>
                <circle cx="35" cy="55" r="4" fill="#5C5552">
                    <animate attributeName="ry" values="4;0.5;4" dur="3s" repeatCount="indefinite" />
                </circle>
                <circle cx="65" cy="55" r="4" fill="#5C5552">
                    <animate attributeName="ry" values="4;0.5;4" dur="3s" repeatCount="indefinite" />
                </circle>
                <circle cx="28" cy="62" r="3" fill="#FFD1DC" opacity="0.6"/>
                <circle cx="72" cy="62" r="3" fill="#FFD1DC" opacity="0.6"/>
            </svg>
        </div>
    </div>

    <header>
        <h1 id="greeting-title">Safe Space</h1>
        <p class="subtitle">åœ¨é€™è£¡ï¼Œä½ ä¸éœ€è¦å‹‰å¼·è‡ªå·±ã€‚</p>
    </header>

    <div class="search-container">
        <input type="text" id="search-input" placeholder="ğŸ” æœå°‹ï¼šå¡”ç¾…ã€å‘¼å¸ã€è¿·æƒ˜...">
    </div>

    <section class="triage-section">
        <div class="triage-title">ç¾åœ¨çš„å¿ƒæƒ…åƒä»€éº¼å¤©æ°£ï¼Ÿ</div>
        <div class="mood-grid" id="mood-grid-container">
            </div>
        <div style="text-align:center; margin-top:15px; font-size:0.9rem; color:var(--text-sub); cursor:pointer; text-decoration:underline;" onclick="resetAllFilters()">
            é¡¯ç¤ºå…¨éƒ¨åŠŸèƒ½
        </div>
        
        <div class="fav-fab-container" onclick="toggleFavFilter()">
            <div class="fav-fab" id="fav-fab-btn">
                <div class="fav-icon">â¤</div>
                <div class="fav-text">æ”¶è—</div>
            </div>
        </div>
    </section>

    <section class="toolbox-grid" id="toolbox">
        </section>

    <div id="active-feature-container">
        <div class="modal-header">
            <button class="close-btn" onclick="history.back()">é—œé–‰ âœ•</button>
        </div>
        <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;">
            <h2 id="feature-title-display" style="text-align: center; font-size: 2rem; color: var(--primary); margin-bottom: 20px; font-weight:900;">åŠŸèƒ½åç¨±</h2>
            <div id="feature-content-area" style="text-align: center;">
                <p style="font-size: 1.1rem; color: var(--text-sub);">âœ¨ è¼•è¼•åœ°å¸æ°£ï¼Œæ…¢æ…¢åœ°åæ°£ âœ¨</p>
                <p style="font-size: 0.9rem; color: #CCC; margin-top:10px;">(åŠŸèƒ½å»ºç½®ä¸­)</p>
            </div>
        </div>
    </div>

    <script>
        
        // ============================================
        // 1. è³‡æ–™åº« (SVG æ¸²æŸ“å¼•æ“)
        // ============================================

        // --- SVG å…ƒä»¶ ---
        const DOUGH_BODY = `<path d="M50 15C30 15 10 30 10 60C10 85 25 95 50 95C75 95 90 85 90 60C90 30 70 15 50 15Z" fill="#FFFFFF" stroke="#5C5552" stroke-width="2.5"/>`;
        const CHEEKS = `<circle cx="28" cy="62" r="3.5" fill="#FFD1DC" opacity="0.9"/><circle cx="72" cy="62" r="3.5" fill="#FFD1DC" opacity="0.9"/>`;

        function getMoodIcon(moodId) {
            let content = '';
            switch(moodId) {
                case 'anxious': 
                    content = `${DOUGH_BODY} ${CHEEKS}<g style="animation: sway 0.2s infinite"><circle cx="35" cy="55" r="4" fill="#5C5552"/><circle cx="65" cy="55" r="4" fill="#5C5552"/><path d="M45 68 Q50 72 55 68" stroke="#5C5552" stroke-width="2" fill="none"/></g><path d="M20 30 Q20 40 25 40 Q30 40 30 30" fill="#A0C4FF" style="animation: tearDrop 1s infinite"/>`;
                    break;
                case 'low': 
                    content = `<path d="M50 35C30 35 10 45 10 70C10 90 25 95 50 95C75 95 90 90 90 70C90 45 70 35 50 35Z" fill="#FFFFFF" stroke="#5C5552" stroke-width="2.5"/>${CHEEKS}<path d="M30 60 L40 65" stroke="#5C5552" stroke-width="2" stroke-linecap="round"/><path d="M70 60 L60 65" stroke="#5C5552" stroke-width="2" stroke-linecap="round"/><path d="M45 75 Q50 70 55 75" stroke="#5C5552" stroke-width="2" fill="none"/>`;
                    break;
                case 'angry':
                    content = `${DOUGH_BODY}<path d="M30 50 L40 55" stroke="#5C5552" stroke-width="2.5"/><path d="M70 50 L60 55" stroke="#5C5552" stroke-width="2.5"/><circle cx="35" cy="60" r="3" fill="#5C5552"/><circle cx="65" cy="60" r="3" fill="#5C5552"/><path d="M45 75 Q50 70 55 75" stroke="#5C5552" stroke-width="2" fill="none"/><path d="M50 10 L50 5" stroke="#FF6B6B" stroke-width="3" style="animation: floatItem 0.5s infinite"/><path d="M60 12 L62 6" stroke="#FF6B6B" stroke-width="3" style="animation: floatItem 0.6s infinite"/>`;
                    break;
                case 'numb':
                    content = `<path d="M50 15C30 15 10 30 10 60C10 85 25 95 50 95C75 95 90 85 90 60C90 30 70 15 50 15Z" fill="#FFFFFF" stroke="#5C5552" stroke-width="2.5" stroke-dasharray="4 4"/><circle cx="28" cy="62" r="3.5" fill="#DDD" opacity="0.9"/><circle cx="72" cy="62" r="3.5" fill="#DDD" opacity="0.9"/><circle cx="35" cy="55" r="4" stroke="#5C5552" stroke-width="2" fill="none"/><circle cx="65" cy="55" r="4" stroke="#5C5552" stroke-width="2" fill="none"/><line x1="45" y1="70" x2="55" y2="70" stroke="#5C5552" stroke-width="2"/>`;
                    break;
                case 'confused':
                    content = `${DOUGH_BODY} ${CHEEKS}<g style="animation: spinEye 3s linear infinite; transform-origin: 35px 55px"><path d="M35 55 m-3 0 a 3 3 0 1 0 6 0 a 3 3 0 1 0 -6 0" stroke="#5C5552" stroke-width="1.5" fill="none"/></g><g style="animation: spinEye 3s linear infinite reverse; transform-origin: 65px 55px"><path d="M65 55 m-3 0 a 3 3 0 1 0 6 0 a 3 3 0 1 0 -6 0" stroke="#5C5552" stroke-width="1.5" fill="none"/></g><path d="M48 70 Q50 68 52 70" stroke="#5C5552" stroke-width="2"/>`;
                    break;
                case 'panic': 
                    content = `<g style="animation: panicWave 0.2s infinite">${DOUGH_BODY} ${CHEEKS}<circle cx="35" cy="55" r="5" fill="#5C5552"/><circle cx="65" cy="55" r="5" fill="#5C5552"/><ellipse cx="50" cy="72" rx="6" ry="8" fill="#5C5552"/><path d="M10 60 L0 50" stroke="#5C5552" stroke-width="3"/><path d="M90 60 L100 50" stroke="#5C5552" stroke-width="3"/></g>`;
                    break;
            }
            return `<svg viewBox="0 0 100 100" fill="none" class="mood-icon-svg">${content}</svg>`;
        }

        function getFeatureIcon(id) {
            let content = '';
            let eyes = `<circle cx="35" cy="55" r="4" fill="#5C5552"/><circle cx="65" cy="55" r="4" fill="#5C5552"/>`;
            let mouth = `<path d="M45 68 Q50 72 55 68" stroke="#5C5552" stroke-width="2" fill="none"/>`;

            switch(id) {
                case 'dbt_cards':
                    content = `${DOUGH_BODY} ${CHEEKS} ${eyes} <path d="M45 65 Q50 75 55 65" stroke="#5C5552" stroke-width="2" fill="none"/><rect x="60" y="40" width="20" height="30" rx="2" fill="white" stroke="#5C5552" stroke-width="2" transform="rotate(15 60 40)" style="animation: floatItem 2s infinite"/><path d="M65 45 L75 50" stroke="#FFD1DC" stroke-width="2"/>`;
                    break;
                case 'quotes':
                    content = `${DOUGH_BODY} ${CHEEKS} <path d="M30 55 Q35 50 40 55" stroke="#5C5552" stroke-width="2" fill="none"/><path d="M60 55 Q65 50 70 55" stroke="#5C5552" stroke-width="2" fill="none"/><circle cx="50" cy="68" r="4" fill="#5C5552"/><path d="M70 20 H90 V35 H70 L65 40 V20 Z" fill="white" stroke="#5C5552" stroke-width="2"/><circle cx="76" cy="28" r="1.5" fill="#5C5552"/><circle cx="80" cy="28" r="1.5" fill="#5C5552"/><circle cx="84" cy="28" r="1.5" fill="#5C5552"/>`;
                    break;
                case 'tarot':
                    content = `${DOUGH_BODY} ${CHEEKS} <path d="M30 55 L40 55" stroke="#5C5552" stroke-width="2"/><path d="M60 55 L70 55" stroke="#5C5552" stroke-width="2"/><circle cx="50" cy="80" r="12" fill="#E0F7FA" stroke="#5C5552" stroke-width="1.5" opacity="0.8"/><path d="M50 75 L52 77" stroke="white" stroke-width="2"/>`;
                    break;
                case 'answer_book':
                    content = `${DOUGH_BODY} ${CHEEKS} ${eyes} ${mouth} <circle cx="35" cy="55" r="7" stroke="#5C5552" stroke-width="1.5" fill="none"/><circle cx="65" cy="55" r="7" stroke="#5C5552" stroke-width="1.5" fill="none"/><line x1="42" y1="55" x2="58" y2="55" stroke="#5C5552" stroke-width="1.5"/><rect x="75" y="50" width="15" height="25" fill="#5C5552" transform="rotate(10)"/><rect x="78" y="52" width="2" height="21" fill="white" transform="rotate(10)"/>`;
                    break;
                case 'questions':
                    content = `${DOUGH_BODY} ${CHEEKS} <path d="M30 58 L40 58" stroke="#5C5552" stroke-width="2"/><path d="M60 58 L70 58" stroke="#5C5552" stroke-width="2"/><text x="15" y="30" font-size="20" fill="#5C5552" style="animation: floatItem 2s infinite">?</text><text x="75" y="30" font-size="16" fill="#5C5552" style="animation: floatItem 3s infinite reverse">?</text>`;
                    break;
                case 'jokes':
                    content = `${DOUGH_BODY} ${CHEEKS} <path d="M30 50 L35 55 L40 50" stroke="#5C5552" stroke-width="2" fill="none"/><path d="M60 50 L65 55 L70 50" stroke="#5C5552" stroke-width="2" fill="none"/><path d="M40 65 Q50 80 60 65" fill="#5C5552"/><path d="M10 60 Q5 50 15 50" stroke="#5C5552" stroke-width="2" fill="none" style="animation: sway 0.5s infinite"/><path d="M90 60 Q95 50 85 50" stroke="#5C5552" stroke-width="2" fill="none" style="animation: sway 0.5s infinite"/>`;
                    break;
                case 'animals':
                    content = `${DOUGH_BODY} ${CHEEKS} ${eyes} ${mouth} <path d="M30 20 L40 5 L50 20" fill="white" stroke="#5C5552" stroke-width="2.5"/><path d="M50 20 L60 5 L70 20" fill="white" stroke="#5C5552" stroke-width="2.5"/><line x1="20" y1="60" x2="5" y2="55" stroke="#5C5552" stroke-width="1.5"/><line x1="20" y1="65" x2="5" y2="70" stroke="#5C5552" stroke-width="1.5"/><line x1="80" y1="60" x2="95" y2="55" stroke="#5C5552" stroke-width="1.5"/><line x1="80" y1="65" x2="95" y2="70" stroke="#5C5552" stroke-width="1.5"/><path d="M85 80 Q95 80 95 60" stroke="#5C5552" stroke-width="3" fill="none" stroke-linecap="round" style="animation: sway 2s infinite"/>`;
                    break;
                case 'tasks':
                    content = `<g style="animation: muscleFlex 1.5s infinite">${DOUGH_BODY} ${CHEEKS} <line x1="30" y1="48" x2="40" y2="55" stroke="#5C5552" stroke-width="2.5"/><line x1="70" y1="48" x2="60" y2="55" stroke="#5C5552" stroke-width="2.5"/><path d="M45 70 H55" stroke="#5C5552" stroke-width="2"/><path d="M15 60 Q5 50 15 40" stroke="#5C5552" stroke-width="4" fill="none"/><path d="M85 60 Q95 50 85 40" stroke="#5C5552" stroke-width="4" fill="none"/></g>`;
                    break;
                case 'breathing':
                    content = `<g style="animation: breathe 4s ease-in-out infinite">${DOUGH_BODY} ${CHEEKS} <path d="M30 55 Q35 50 40 55" stroke="#5C5552" stroke-width="2" fill="none"/><path d="M60 55 Q65 50 70 55" stroke="#5C5552" stroke-width="2" fill="none"/><circle cx="50" cy="70" r="3" fill="#5C5552"/><path d="M48 85 Q50 90 52 85" stroke="#5C5552" stroke-width="2"/></g>`;
                    break;
                case 'clicker':
                    content = `${DOUGH_BODY} ${CHEEKS} ${mouth} <circle cx="35" cy="55" r="4" fill="#5C5552"/><circle cx="37" cy="53" r="1.5" fill="white"/><circle cx="65" cy="55" r="4" fill="#5C5552"/><circle cx="67" cy="53" r="1.5" fill="white"/><circle cx="80" cy="40" r="5" stroke="#5C5552" fill="white" opacity="0.7"/><circle cx="20" cy="80" r="4" stroke="#5C5552" fill="white" opacity="0.7"/><path d="M80 60 L85 50" stroke="#5C5552" stroke-width="2.5" style="animation: floatItem 0.5s infinite"/>`;
                    break;
                case 'whiteboard':
                    content = `${DOUGH_BODY} ${CHEEKS} ${eyes} ${mouth} <path d="M30 20 Q50 5 70 20 H30 Z" fill="#5C5552"/><rect x="48" y="10" width="4" height="6" fill="#5C5552"/><circle cx="20" cy="70" r="10" fill="white" stroke="#5C5552" stroke-width="1.5"/><circle cx="18" cy="68" r="2" fill="#FF6B6B"/><circle cx="22" cy="72" r="2" fill="#4ECDC4"/><line x1="80" y1="70" x2="90" y2="60" stroke="#5C5552" stroke-width="2"/>`;
                    break;
                case 'conveyor':
                    content = `${DOUGH_BODY} ${CHEEKS} ${eyes} <path d="M45 68 Q50 72 55 68" stroke="#5C5552" stroke-width="2" fill="none"/><rect x="60" y="30" width="15" height="10" rx="2" stroke="#5C5552" fill="white" style="animation: conveyorMove 2s linear infinite"/><line x1="10" y1="85" x2="90" y2="85" stroke="#5C5552" stroke-width="2" stroke-dasharray="5 5"/>`;
                    break;
                case 'worry_jar':
                    content = `<path d="M50 35C30 35 10 45 10 60C10 85 25 95 50 95C75 95 90 85 90 60C90 45 70 35 50 35Z" fill="#FFFFFF" stroke="#5C5552" stroke-width="1.5" stroke-dasharray="2 2"/> ${CHEEKS} ${eyes} ${mouth} <g style="animation: lidOpen 3s infinite"> <path d="M50 35 C30 35 10 45 10 50 L90 50 C90 45 70 35 50 35Z" fill="white" stroke="#5C5552" stroke-width="2"/> </g>`;
                    break;
                case 'sos':
                    content = `${DOUGH_BODY} ${CHEEKS} <path d="M35 55 L40 50 L35 45" stroke="#5C5552" stroke-width="2" fill="none"/><path d="M65 55 L60 50 L65 45" stroke="#5C5552" stroke-width="2" fill="none"/><path d="M45 70 Q50 65 55 70" stroke="#5C5552" stroke-width="2" fill="none"/><rect x="20" y="80" width="60" height="15" fill="#FF6B6B" stroke="#5C5552" rx="2"/><text x="32" y="91" font-family="Arial" font-weight="bold" font-size="10" fill="white">SOS</text><path d="M20 75 L20 80" stroke="#5C5552" stroke-width="2"/><path d="M80 75 L80 80" stroke="#5C5552" stroke-width="2"/>`;
                    break;
                default: 
                    content = `${DOUGH_BODY} ${CHEEKS} ${eyes} ${mouth}`;
                    break;
            }
            return `<svg viewBox="0 0 100 100" fill="none" class="feature-svg">${content}</svg>`;
        }

        // --- åŠŸèƒ½èˆ‡æƒ…ç·’è³‡æ–™ ---
        const featuresDB = [
            { id: 'dbt_cards', name: 'è‡ªæˆ‘ç…§é¡§å¡', tag: 'DBTç­–ç•¥', moods: ['anxious', 'low', 'numb'], keywords: 'å¡ç‰‡,æŠ½å¡,ç­–ç•¥' },
            { id: 'quotes', name: 'ç™‚ç™’é‡‘å¥', tag: 'æ–‡å­—åŠ›é‡', moods: ['low', 'stress'], keywords: 'èªéŒ„,å¥å­,é¼“å‹µ' },
            { id: 'tarot', name: 'å¡”ç¾…æŒ‡å¼•', tag: 'æ½›æ„è­˜', moods: ['anxious', 'confused'], keywords: 'å¡”ç¾…,å åœ' },
            { id: 'answer_book', name: 'è§£ç­”ä¹‹æ›¸', tag: 'éˆæ„ŸæŒ‡å¼•', moods: ['confused', 'anxious'], keywords: 'è§£ç­”,å›°æƒ‘,è¿·æƒ˜' }, 
            { id: 'questions', name: 'å•å¥å¼•å°', tag: 'è‡ªæˆ‘å°è©±', moods: ['low', 'confused', 'numb'], keywords: 'æ•˜äº‹,sfbt,æ€è€ƒ' }, 
            { id: 'jokes', name: 'ç¬‘è©±æ€¥è½‰å½', tag: 'è½‰æ›å¿ƒæƒ…', moods: ['stress', 'low'], keywords: 'ç¬‘è©±,é–‹å¿ƒ' },
            { id: 'animals', name: 'æ¯›å­©ç™‚ç™’', tag: 'è¦–è¦ºå®‰æ’«', moods: ['stress', 'low', 'angry'], keywords: 'è²“,ç‹—,å¯æ„›' },
            { id: 'tasks', name: 'å¾®å°æˆå°±', tag: 'è¡Œå‹•', moods: ['numb', 'low'], keywords: 'ä»»å‹™,å‹•åŠ›' },
            { id: 'breathing', name: 'å‘¼å¸ç·´ç¿’', tag: 'ç”Ÿç†èª¿ç¯€', moods: ['anxious', 'angry', 'panic'], keywords: 'å‘¼å¸,æ”¾é¬†,å†¥æƒ³' },
            { id: 'clicker', name: 'ç´“å£“æ³¡æ³¡', tag: 'é‡‹æ”¾å£“åŠ›', moods: ['stress', 'angry'], keywords: 'æŒ‰éˆ•,æ³¡æ³¡ç´™' },
            { id: 'whiteboard', name: 'æƒ…ç·’å¡—é´‰', tag: 'è¡¨é”', moods: ['angry', 'confused', 'numb'], keywords: 'ç•«ç•«,å¯«å­—,ç™½æ¿' },
            { id: 'conveyor', name: 'å¿µé ­è¼¸é€å¸¶', tag: 'ACTè„«é‰¤', moods: ['anxious', 'stress'], keywords: 'å¿µé ­,æƒ³æ³•' },
            { id: 'worry_jar', name: 'ç…©æƒ±å¯„æ”¾', tag: 'é‚Šç•Œè¨­å®š', moods: ['anxious', 'stress'], keywords: 'ç…©æƒ±,ç¡ä¸è‘—' },
            { id: 'sos', name: 'å®‰å…¨ç¶² SOS', tag: 'å±æ©Ÿæ±‚åŠ©', moods: ['panic', 'low'], keywords: 'æ±‚æ•‘,é›»è©±' }
        ];

        const moodOptions = [
            { id: 'anxious', label: 'ğŸ˜° ç„¦æ…®æ…Œå¼µ', color: '#A0C4FF' },
            { id: 'low', label: 'ğŸ˜ ä½è½ç„¡åŠ›', color: '#5C5552' },
            { id: 'angry', label: 'ğŸ˜¡ ç”Ÿæ°£æ†¤æ€’', color: '#FF6B6B' },
            { id: 'numb', label: 'ğŸ˜¶ éº»æœ¨æ”¾ç©º', color: '#CCCCCC' },
            { id: 'confused', label: 'ğŸ¤” è¿·æƒ˜å›°æƒ‘', color: '#BDB2FF' },
            { id: 'panic', label: 'ğŸ†˜ å¿«å´©æ½°äº†', color: '#FFADAD' }
        ];

        // ============================================
        // 2. é‚è¼¯æ§åˆ¶ (Logic Controller)
        // ============================================

        // ç‹€æ…‹è®Šæ•¸
        let favorites = JSON.parse(localStorage.getItem('safeSpaceFavs')) || [];
        let userNickname = localStorage.getItem('safeSpaceName') || "";
        let isMusicOn = JSON.parse(localStorage.getItem('safeSpaceMusicOn')) ?? true; 
        let isSfxOn = JSON.parse(localStorage.getItem('safeSpaceSfxOn')) ?? true; 
        let isPetActive = JSON.parse(localStorage.getItem('safeSpacePetActive')) ?? true; 
        let isDarkMode = JSON.parse(localStorage.getItem('safeSpaceDarkMode')) ?? false;
        
        let selectedMoods = new Set();
        let isFavFilterActive = false;
        let searchKeyword = "";

        // DOM Elements
        const toolboxEl = document.getElementById('toolbox');
        const moodGrid = document.getElementById('mood-grid-container');
        const searchInput = document.getElementById('search-input');
        const favFabBtn = document.getElementById('fav-fab-btn');
        const petEl = document.getElementById('spirit-pet');
        const greetingTitle = document.getElementById('greeting-title');
        const splashScreen = document.getElementById('splash-screen');
        
        // è¨­å®šç›¸é—œ DOM
        const settingsModal = document.getElementById('settings-modal');
        const nicknameInput = document.getElementById('nickname-input');
        const musicToggle = document.getElementById('setting-music-toggle');
        const sfxToggle = document.getElementById('setting-sfx-toggle');
        const petToggle = document.getElementById('setting-pet-toggle');
        const darkToggle = document.getElementById('setting-dark-toggle');

        function initApp() {
            // å¥—ç”¨æ·±è‰²æ¨¡å¼
            if (isDarkMode) document.body.classList.add('dark-mode');

            renderMoodButtons();
            updateResults();
            initPetSystem();
            initSettings(); 
            updateGreeting(); 
            
            // ç¶å®š Splash é»æ“Š (è§¸ç™¼ AudioContext èˆ‡è‡ªå‹•æ’­æ”¾)
            const splashBtn = document.getElementById('splash-start-btn');
            splashBtn.onclick = () => {
                splashScreen.style.opacity = '0';
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                    document.body.style.overflow = 'auto'; // é–‹æ”¾æ²å‹•
                }, 800);
                
                // å•Ÿå‹•éŸ³è¨Šæ ¸å¿ƒ
                resumeAudioContext();
                if(isMusicOn) playNextNote(); // è‡ªå‹•æ’­æ”¾
            };
        }

        function updateGreeting() {
            if (userNickname && userNickname.trim() !== "") {
                const hour = new Date().getHours();
                let greet = "ä½ å¥½";
                if (hour < 6) greet = "å¤œæ·±äº†";
                else if (hour < 11) greet = "æ—©å®‰";
                else if (hour < 14) greet = "åˆå®‰";
                else if (hour < 18) greet = "ä¸‹åˆå¥½";
                else greet = "æ™šå®‰";
                
                // å¼·åˆ¶é¡æ–‡å­—ç”¨ Arialï¼Œé¿å…è·‘ç‰ˆ
                greetingTitle.innerHTML = `${greet}ï¼Œ${userNickname} <span class="kaomoji" style="font-size:0.8em; margin-left:5px;">( Ë˜ Â³Ë˜)</span>`;
            } else {
                greetingTitle.innerHTML = 'Safe Space <span class="kaomoji" style="font-size:0.8em; margin-left:5px;">( Ë˜ Â³Ë˜)</span>';
            }
        }

        // --- è¨­å®šåŠŸèƒ½æ•´åˆ ---
        function initSettings() {
            // 1. æš±ç¨±
            nicknameInput.value = userNickname;
            nicknameInput.addEventListener('input', (e) => {
                userNickname = e.target.value;
                localStorage.setItem('safeSpaceName', userNickname);
                updateGreeting();
            });

            // 2. æ·±è‰²æ¨¡å¼
            updateToggleUI(darkToggle, isDarkMode);
            darkToggle.onclick = () => {
                isDarkMode = !isDarkMode;
                localStorage.setItem('safeSpaceDarkMode', isDarkMode);
                updateToggleUI(darkToggle, isDarkMode);
                if(isDarkMode) document.body.classList.add('dark-mode');
                else document.body.classList.remove('dark-mode');
            };

            // 3. éŸ³æ¨‚é–‹é—œ
            updateToggleUI(musicToggle, isMusicOn);
            musicToggle.onclick = () => {
                isMusicOn = !isMusicOn;
                localStorage.setItem('safeSpaceMusicOn', isMusicOn);
                updateToggleUI(musicToggle, isMusicOn);
                
                if (isMusicOn) {
                    resumeAudioContext();
                    if (!bgmTimeout) playNextNote();
                } else {
                    clearTimeout(bgmTimeout);
                    bgmTimeout = null;
                }
            };

            // 4. éŸ³æ•ˆé–‹é—œ
            updateToggleUI(sfxToggle, isSfxOn);
            sfxToggle.onclick = () => {
                isSfxOn = !isSfxOn;
                localStorage.setItem('safeSpaceSfxOn', isSfxOn);
                updateToggleUI(sfxToggle, isSfxOn);
            };

            // 5. ç²¾éˆé–‹é—œ
            updateToggleUI(petToggle, isPetActive);
            petToggle.onclick = () => {
                isPetActive = !isPetActive;
                localStorage.setItem('safeSpacePetActive', isPetActive);
                updateToggleUI(petToggle, isPetActive);
                updatePetVisibility();
            };
        }

        function updateToggleUI(el, isActive) {
            if(isActive) el.classList.add('active');
            else el.classList.remove('active');
        }

        function openSettings() {
            settingsModal.style.display = 'flex';
            void settingsModal.offsetWidth; 
            settingsModal.classList.add('show');
            // æ¨å…¥æ­·å²ç´€éŒ„ä»¥æ”¯æ´è¿”å›éµé—œé–‰
            history.pushState({ type: 'settings' }, null, "#settings");
        }
        function closeSettings(e) {
            if(e.target === settingsModal) {
                history.back(); // è§¸ç™¼ popstate ä¾†é—œé–‰
            }
        }
        function toggleSettings() {
            if(settingsModal.classList.contains('show')) {
                history.back();
            } else {
                openSettings();
            }
        }

        function resetAppData() {
            if(confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è¨­å®šå’Œæ”¶è—å—ï¼Ÿé€™å°‡ç„¡æ³•å¾©åŸã€‚')) {
                localStorage.clear();
                location.reload();
            }
        }


        // --- æ ¸å¿ƒäº’å‹•é‚è¼¯ ---
        function renderMoodButtons() {
            moodGrid.innerHTML = '';
            moodOptions.forEach(mood => {
                const btn = document.createElement('div');
                btn.className = 'mood-card';
                btn.dataset.id = mood.id;
                btn.onclick = () => toggleMood(mood.id);
                btn.innerHTML = `
                    ${getMoodIcon(mood.id)}
                    <div class="mood-label">${mood.label}</div>
                `;
                btn.style.setProperty('--mood-color', mood.color);
                moodGrid.appendChild(btn);
            });
        }

        function updateResults() {
            // æ›´æ–°æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.mood-card').forEach(btn => {
                const id = btn.dataset.id;
                const moodData = moodOptions.find(m => m.id === id);
                if(selectedMoods.has(id)) {
                    btn.classList.add('active');
                    btn.style.borderColor = moodData.color; 
                } else {
                    btn.classList.remove('active');
                    btn.style.borderColor = 'transparent';
                }
            });

            // æ›´æ–°æ”¶è—æŒ‰éˆ•
            if(isFavFilterActive) favFabBtn.classList.add('active');
            else favFabBtn.classList.remove('active');

            // ç¯©é¸é‚è¼¯
            let filtered = featuresDB.filter(item => {
                const matchKeyword = searchKeyword === "" || item.name.includes(searchKeyword) || item.keywords.includes(searchKeyword) || item.tag.includes(searchKeyword);
                const itemMoodsSet = new Set(item.moods);
                const hasMoodIntersection = [...selectedMoods].some(mood => itemMoodsSet.has(mood));
                const matchMood = selectedMoods.size === 0 || hasMoodIntersection;
                const matchFav = !isFavFilterActive || favorites.includes(item.id);
                return matchKeyword && matchMood && matchFav;
            });
            renderFeatures(filtered);
        }

        function renderFeatures(list) {
            toolboxEl.innerHTML = '';
            if (list.length === 0) {
                toolboxEl.innerHTML = `<div style="grid-column:span 2; text-align:center; padding:30px; color:#aaa; font-weight:700;">ğŸ‚<br>é€™è£¡ç©ºç©ºçš„</div>`;
                return;
            }
            list.forEach(feature => {
                const isFav = favorites.includes(feature.id);
                const card = document.createElement('div');
                card.className = 'feature-card';
                card.innerHTML = `
                    <div class="card-fav-btn ${isFav ? 'is-active' : ''}" onclick="toggleCardFav(event, '${feature.id}')">
                        ${isFav ? 'â¤ï¸' : 'ğŸ¤'}
                    </div>
                    <div class="card-visual">${getFeatureIcon(feature.id)}</div>
                    <div class="card-title">${feature.name}</div>
                    <div class="card-tag">${feature.tag}</div>
                `;
                card.onclick = (e) => {
                    if(e.target.classList.contains('card-fav-btn')) return;
                    openFeature(feature);
                };
                toolboxEl.appendChild(card);
            });
        }

        function toggleMood(moodId) {
            if (selectedMoods.has(moodId)) selectedMoods.delete(moodId);
            else selectedMoods.add(moodId);
            ensureHistoryState();
            updateResults();
        }

        function toggleFavFilter() {
            isFavFilterActive = !isFavFilterActive;
            ensureHistoryState();
            updateResults();
        }

        function toggleCardFav(event, id) {
            event.stopPropagation();
            if (favorites.includes(id)) favorites = favorites.filter(favId => favId !== id);
            else favorites.push(id);
            localStorage.setItem('safeSpaceFavs', JSON.stringify(favorites));
            
            if (isSfxOn) { /* å¯ä»¥åœ¨é€™è£¡åŠ ä¸€å€‹è¼•å¾®çš„é»æ“ŠéŸ³æ•ˆ */ }
            
            if(isFavFilterActive) updateResults();
            else {
                const btn = event.currentTarget;
                const isNowFav = favorites.includes(id);
                btn.innerHTML = isNowFav ? 'â¤ï¸' : 'ğŸ¤';
                btn.classList.toggle('is-active');
            }
        }

        searchInput.addEventListener('input', (e) => {
            searchKeyword = e.target.value.toLowerCase().trim();
            if(searchKeyword !== "") ensureHistoryState();
            updateResults();
        });

        function resetAllFilters() {
            selectedMoods.clear();
            isFavFilterActive = false;
            searchKeyword = "";
            searchInput.value = "";
            updateResults();
        }

        function ensureHistoryState() {
            if (window.location.hash !== '#filter' && window.location.hash !== '#feature') {
                history.pushState({ type: 'filter' }, null, '#filter');
            }
        }
        
       /* =========================================
   1. å®šç¾©å…·é«”çš„å…§å®¹æ¸²æŸ“é‚è¼¯ (Renderers)
   ========================================= */
const renderers = {
    // å°ˆé–€è™•ç† DBT çš„ç•«é¢
    renderDbtCards: (container) => {
        container.innerHTML = `
            <div class="dbt-card-container">
                <div id="dbt-card-text" class="dbt-text">
                    âœ¨ ç•¶æƒ…ç·’åƒæµ·æµªè¥²ä¾†ï¼Œ<br>æˆ‘å€‘éœ€è¦ä¸€å€‹è¡æµªæ¿ã€‚
                </div>
                <button id="draw-dbt-btn" class="dbt-btn">
                    ğŸ”® æŠ½å–ä¸€å¼µæ™ºæ…§å°å¡
                </button>
            </div>
        `;

        // å®šç¾©å¡ç‰‡å…§å®¹
        const cards = [
            "ã€åœ (STOP)ã€‘ï¼šç¾åœ¨è«‹æš«åœå‹•ä½œã€‚åˆ¥å‹•ï¼æ·±å‘¼å¸ã€‚ä¸è¦è®“æƒ…ç·’æ§åˆ¶ä½ çš„è¡Œç‚ºã€‚",
            "ã€å†·éœè§€å¯Ÿã€‘ï¼šåƒå€‹å±€å¤–äººä¸€æ¨£çœ‹è‘—è‡ªå·±çš„æƒ…ç·’ï¼Œä¸è¦æ€¥è‘—æ‰¹åˆ¤å®ƒã€‚",
            "ã€å®‰æ’«äº”æ„Ÿã€‘ï¼šæ³¡æ¯ç†±èŒ¶ã€èèå–œæ­¡çš„ç²¾æ²¹ã€æ‘¸æ‘¸æŸ”è»Ÿçš„æ¯¯å­ã€‚",
            "ã€ç›¸åè¡Œå‹•ã€‘ï¼šå¦‚æœä½ æƒ³é€€ç¸®ï¼Œè©¦è‘—æŒºèµ·èƒ¸è†›ï¼›å¦‚æœä½ æƒ³æ”»æ“Šï¼Œè©¦è‘—æ”¾é¬†é›™æ‰‹ã€‚"
        ];

        // ç¶å®šæŒ‰éˆ•äº‹ä»¶ (å› ç‚ºæŒ‰éˆ•æ˜¯å‰›å‰›æ‰ç”Ÿå‡ºä¾†çš„ï¼Œè¦ç«‹åˆ»æ•™å®ƒåšäº‹)
        document.getElementById('draw-dbt-btn').addEventListener('click', (e) => {
            // æŒ‰éˆ•å°å‹•ç•«
            e.target.style.transform = 'scale(0.95)';
            setTimeout(() => e.target.style.transform = 'scale(1)', 100);

            // æŠ½å¡é‚è¼¯
            const textEl = document.getElementById('dbt-card-text');
            textEl.style.opacity = 0;
            setTimeout(() => {
                const randomCard = cards[Math.floor(Math.random() * cards.length)];
                textEl.innerText = randomCard;
                textEl.style.opacity = 1;
            }, 200);
        });
    },
renderAnswerBook: (container) => {
    // 1. å®šç¾©æ¨¡ç³Šä½†å…·å•Ÿç™¼æ€§çš„ç­”æ¡ˆåº« (å¯ä»¥è‡ªå·±ç„¡é™æ“´å……)
   // ğŸ”® æ“´å……å¾Œçš„ 200+ å¥è§£ç­”åº«
const ab_answers = [
    // --- æ­£å‘è‚¯å®š (Action & Yes) ---
    "æ¯«ç„¡ç–‘å•ã€‚<span class='ab-en'>Without a doubt.</span>",
    "é€™å°±æ˜¯ä½ æƒ³è¦çš„ç­”æ¡ˆã€‚<span class='ab-en'>This is the answer you seek.</span>",
    "æ”¾æ‰‹å»åšã€‚<span class='ab-en'>Just do it.</span>",
    "çµ•å°æ˜¯ã€‚<span class='ab-en'>Absolutely.</span>",
    "ç¾åœ¨å°±æ˜¯æœ€ä½³æ™‚æ©Ÿã€‚<span class='ab-en'>Now is the perfect time.</span>",
    "é€™æ˜¯ä¸€å€‹å¾ˆæ£’çš„è¨ˆç•«ã€‚<span class='ab-en'>It is a great plan.</span>",
    "çµæœæœƒè®“ä½ é©šå–œã€‚<span class='ab-en'>The outcome will surprise you.</span>",
    "å‹‡å¾€ç›´å‰ã€‚<span class='ab-en'>Go for it.</span>",
    "ç›¸ä¿¡ä½ çš„ç›´è¦ºã€‚<span class='ab-en'>Trust your intuition.</span>",
    "æ˜¯çš„ï¼Œç«‹åˆ»ã€‚<span class='ab-en'>Yes, immediately.</span>",
    "é€™å€¼å¾—å†’éšªã€‚<span class='ab-en'>It is worth the risk.</span>",
    "ä½ æœƒæˆåŠŸçš„ã€‚<span class='ab-en'>You will succeed.</span>",
    "ä¸è¦çŒ¶è±«ã€‚<span class='ab-en'>Don't hesitate.</span>",
    "é€™å°‡å¸¶ä¾†å¥½é‹ã€‚<span class='ab-en'>It will bring good luck.</span>",
    "å…¨åŠ›ä»¥èµ´ã€‚<span class='ab-en'>Give it your all.</span>",
    "é€™æ˜¯æ­£ç¢ºçš„æ–¹å‘ã€‚<span class='ab-en'>You are on the right path.</span>",
    "ä½ çš„é¸æ“‡æ˜¯å°çš„ã€‚<span class='ab-en'>Your choice is correct.</span>",
    "å®ƒæœƒå¸¶ä¾†å¿«æ¨‚ã€‚<span class='ab-en'>It will bring joy.</span>",
    "ä¿æŒæ¨‚è§€ã€‚<span class='ab-en'>Stay optimistic.</span>",
    "å»åšå°±å°äº†ã€‚<span class='ab-en'>Just go ahead.</span>",
    "ä½ å·²ç¶“æº–å‚™å¥½äº†ã€‚<span class='ab-en'>You are ready.</span>",
    "é€™å°ä½ æœ‰åˆ©ã€‚<span class='ab-en'>The odds are in your favor.</span>",
    "é€™æ˜¯ä¸€æ¬¡åƒè¼‰é›£é€¢çš„æ©Ÿæœƒã€‚<span class='ab-en'>Once in a lifetime opportunity.</span>",
    "é€™ä»¶äº‹æœƒå¾ˆé †åˆ©ã€‚<span class='ab-en'>It will go smoothly.</span>",
    "ç›¡åŠ›è€Œç‚ºï¼Œå¿…æœ‰å›å ±ã€‚<span class='ab-en'>Do your best, and it will pay off.</span>",
    "ä½ æœƒå¾—åˆ°æ”¯æŒã€‚<span class='ab-en'>You will be supported.</span>",
    "æƒ…æ³æ­£åœ¨å¥½è½‰ã€‚<span class='ab-en'>Things are getting better.</span>",
    "ç›¸ä¿¡ä½ è‡ªå·±ã€‚<span class='ab-en'>Believe in yourself.</span>",
    "é€™æ˜¯ä¸€æ¢åº·èŠå¤§é“ã€‚<span class='ab-en'>It is a promising path.</span>",
    "ä½ æœƒç‚ºæ­¤æ„Ÿåˆ°è‡ªè±ªã€‚<span class='ab-en'>You will be proud of this.</span>",
    "ç¾åœ¨é–‹å§‹ã€‚<span class='ab-en'>Start now.</span>",
    "åˆ¥å›é ­ã€‚<span class='ab-en'>Don't look back.</span>",
    "ä½ æ¯”æƒ³åƒä¸­æ›´å¼·å¤§ã€‚<span class='ab-en'>You are stronger than you think.</span>",
    "é€™æ˜¯å‘½é‹çš„å®‰æ’ã€‚<span class='ab-en'>It is destiny.</span>",
    "å»çˆ­å–ã€‚<span class='ab-en'>Fight for it.</span>",
    "æ¥å—é€™å€‹æŒ‘æˆ°ã€‚<span class='ab-en'>Accept the challenge.</span>",
    "ä½ æœƒå–œæ­¡çµæœçš„ã€‚<span class='ab-en'>You will love the result.</span>",
    "é€™ä¸€é å°‡æ˜¯ç²¾å½©çš„ã€‚<span class='ab-en'>This chapter will be amazing.</span>",
    "æ˜¯çš„ã€‚<span class='ab-en'>Yes.</span>",
    "ç•¶ç„¶ã€‚<span class='ab-en'>Of course.</span>",

    // --- å¦å®šèˆ‡ç…è»Š (Stop & No) ---
    "çµ•å°ä¸æ˜¯ã€‚<span class='ab-en'>Absolutely not.</span>",
    "ä¸è¦é€™éº¼åšã€‚<span class='ab-en'>Don't do it.</span>",
    "ç¾åœ¨ä¸æ˜¯æ™‚å€™ã€‚<span class='ab-en'>Now is not the time.</span>",
    "é€™æ˜¯ä¸€å€‹é™·é˜±ã€‚<span class='ab-en'>It is a trap.</span>",
    "ä½ éœ€è¦åœä¸‹ä¾†ã€‚<span class='ab-en'>You need to stop.</span>",
    "é‚„ä¸æ˜¯æ™‚å€™ã€‚<span class='ab-en'>Not yet.</span>",
    "å†è€ƒæ…®ä¸€ä¸‹ã€‚<span class='ab-en'>Reconsider it.</span>",
    "é€™ä¸æ˜¯å€‹å¥½ä¸»æ„ã€‚<span class='ab-en'>It's not a good idea.</span>",
    "çµæœå¯èƒ½ä¸å¦‚é æœŸã€‚<span class='ab-en'>The outcome may disappoint you.</span>",
    "æœ€å¥½ä¸è¦ã€‚<span class='ab-en'>Better not.</span>",
    "è«‹ä¸‰æ€è€Œå¾Œè¡Œã€‚<span class='ab-en'>Think twice.</span>",
    "é€™æ¢è·¯è¡Œä¸é€šã€‚<span class='ab-en'>This way won't work.</span>",
    "é¢¨éšªå¤ªå¤§äº†ã€‚<span class='ab-en'>The risk is too high.</span>",
    "æ”¾ä¸‹å®ƒã€‚<span class='ab-en'>Let it go.</span>",
    "é€™ä¸å€¼å¾—ã€‚<span class='ab-en'>It is not worth it.</span>",
    "ä½ æœƒå¾Œæ‚”çš„ã€‚<span class='ab-en'>You will regret it.</span>",
    "ä¿æŒç¾ç‹€ã€‚<span class='ab-en'>Stay as you are.</span>",
    "ä¸è¦å¼·æ±‚ã€‚<span class='ab-en'>Don't force it.</span>",
    "é€™ä»¶äº‹æœ‰è®Šæ•¸ã€‚<span class='ab-en'>Variables exist.</span>",
    "å°å¿ƒè¡Œäº‹ã€‚<span class='ab-en'>Proceed with caution.</span>",
    "æš«æ™‚æ“±ç½®ã€‚<span class='ab-en'>Put it on hold.</span>",
    "é€™æ˜¯éŒ¯èª¤çš„é¸æ“‡ã€‚<span class='ab-en'>It is the wrong choice.</span>",
    "ä¸è¦è¡å‹•ã€‚<span class='ab-en'>Don't be impulsive.</span>",
    "ç¾åœ¨ä¸è¦ã€‚<span class='ab-en'>Not now.</span>",
    "ä½ éœ€è¦æ›´å¤šè³‡è¨Šã€‚<span class='ab-en'>You need more information.</span>",
    "é€™æœƒè®“ä½ åˆ†å¿ƒã€‚<span class='ab-en'>It will distract you.</span>",
    "æ‹’çµ•ã€‚<span class='ab-en'>Refuse.</span>",
    "ä¸è¦æµªè²»æ™‚é–“ã€‚<span class='ab-en'>Don't waste time.</span>",
    "çµæœä¸æ¨‚è§€ã€‚<span class='ab-en'>The outlook is not good.</span>",
    "é€™ä¸æ˜¯ä½ è©²ç®¡çš„äº‹ã€‚<span class='ab-en'>It's none of your business.</span>",
    "é é›¢å®ƒã€‚<span class='ab-en'>Stay away from it.</span>",
    "ä½ æœƒå¤±æœ›çš„ã€‚<span class='ab-en'>You will be disappointed.</span>",
    "ä¸è¦æŠ±å¤ªå¤§æœŸæœ›ã€‚<span class='ab-en'>Don't expect too much.</span>",
    "é€™æœƒå¾ˆå›°é›£ã€‚<span class='ab-en'>It will be difficult.</span>",
    "ä¸è¦è¢«è¡¨è±¡è¿·æƒ‘ã€‚<span class='ab-en'>Don't be fooled by appearances.</span>",
    "é€™ä¸é©åˆä½ ã€‚<span class='ab-en'>It's not for you.</span>",

    // --- æ™‚é–“ç›¸é—œ (Timing) ---
    "ç­‰å¾…ã€‚<span class='ab-en'>Wait.</span>",
    "è€å¿ƒæ˜¯é—œéµã€‚<span class='ab-en'>Patience is key.</span>",
    "ä¸€å€‹æœˆå¾Œã€‚<span class='ab-en'>In a month.</span>",
    "æ˜å¹´ã€‚<span class='ab-en'>Next year.</span>",
    "æ˜å¤©å†æ±ºå®šã€‚<span class='ab-en'>Decide tomorrow.</span>",
    "å¾ˆå¿«ã€‚<span class='ab-en'>Very soon.</span>",
    "é‚„éœ€è¦ä¸€é»æ™‚é–“ã€‚<span class='ab-en'>It needs more time.</span>",
    "æ™‚æ©Ÿå°šæœªæˆç†Ÿã€‚<span class='ab-en'>The time is not ripe.</span>",
    "ç¾åœ¨å¤ªæ—©äº†ã€‚<span class='ab-en'>Too early.</span>",
    "å†ç­‰ä¸€ç­‰ã€‚<span class='ab-en'>Wait a little longer.</span>",
    "é€™éœ€è¦æ™‚é–“ç™¼é…µã€‚<span class='ab-en'>Let it brew.</span>",
    "åˆ¥æ€¥ã€‚<span class='ab-en'>No rush.</span>",
    "æ™‚é–“æœƒè­‰æ˜ä¸€åˆ‡ã€‚<span class='ab-en'>Time will tell.</span>",
    "ä½ éœ€è¦ä¼‘æ¯ã€‚<span class='ab-en'>You need rest.</span>",
    "é€™æ˜¯ä¸€å€‹æ¼«é•·çš„éç¨‹ã€‚<span class='ab-en'>It is a long process.</span>",
    "ä¸è¦æ€¥æ–¼æ±‚æˆã€‚<span class='ab-en'>Don't rush success.</span>",
    "ä¸‹é€±æœƒæœ‰ç­”æ¡ˆã€‚<span class='ab-en'>Answer comes next week.</span>",
    "ç¾åœ¨ä¸æ˜¯æ“”å¿ƒçš„æ™‚åˆ»ã€‚<span class='ab-en'>Not the time to worry.</span>",
    "å¹¾å¹´å¾Œä½ æœƒæ„Ÿè¬è‡ªå·±ã€‚<span class='ab-en'>You'll thank yourself later.</span>",
    "é€™ä»¶äº‹æ€¥ä¸ä¾†ã€‚<span class='ab-en'>It cannot be rushed.</span>",
    "åœ¨æ˜¥å¤©ä¾†è‡¨ä¹‹å‰ã€‚<span class='ab-en'>Before spring comes.</span>",
    "å°±åœ¨çœ¼å‰ã€‚<span class='ab-en'>It is right in front of you.</span>",
    "é€™éœ€è¦é•·æœŸæŠ—æˆ°ã€‚<span class='ab-en'>It requires endurance.</span>",
    "æ”¾æ…¢è…³æ­¥ã€‚<span class='ab-en'>Slow down.</span>",
    "ä¸è¦è¶•é€²åº¦ã€‚<span class='ab-en'>Don't push the pace.</span>",
    "è®“å­å½ˆé£›ä¸€æœƒå…’ã€‚<span class='ab-en'>Let it unfold.</span>",
    "æ™‚é–“æ˜¯æœ€å¥½çš„è§£è—¥ã€‚<span class='ab-en'>Time is the best healer.</span>",
    "æ™‚æ©Ÿç¨ç¸±å³é€ã€‚<span class='ab-en'>Opportunity is fleeting.</span>",
    "ä½ éœ€è¦ç¡å€‹å¥½è¦ºå†ä¾†æƒ³ã€‚<span class='ab-en'>Sleep on it.</span>",
    "ä¸è¦åœ¨é€™å€‹é€±æœ«åšæ±ºå®šã€‚<span class='ab-en'>Don't decide this weekend.</span>",
    "é€™é€±ä¸é©åˆã€‚<span class='ab-en'>Not this week.</span>",
    "é‚„æœ‰æ©Ÿæœƒã€‚<span class='ab-en'>There is still a chance.</span>",

    // --- å°‹æ±‚å¤–éƒ¨è³‡æº (External Help) ---
    "å»å•å•ä½ çš„æ¯è¦ªã€‚<span class='ab-en'>Ask your mother.</span>",
    "è½å¾å°ˆå®¶çš„å»ºè­°ã€‚<span class='ab-en'>Listen to experts.</span>",
    "æœ‰äººåœ¨æš—ä¸­å¹«åŠ©ä½ ã€‚<span class='ab-en'>Someone is helping you secretly.</span>",
    "é€™éœ€è¦åˆä½œã€‚<span class='ab-en'>Collaboration is needed.</span>",
    "ä½ çš„æœ‹å‹çŸ¥é“ç­”æ¡ˆã€‚<span class='ab-en'>Your friend knows.</span>",
    "å°‹æ±‚å”åŠ©ã€‚<span class='ab-en'>Seek help.</span>",
    "ä¸è¦ç¨è‡ªæ‰¿æ“”ã€‚<span class='ab-en'>Don't bear it alone.</span>",
    "èˆ‡äººåˆ†äº«ã€‚<span class='ab-en'>Share it.</span>",
    "è½è½åˆ¥äººçš„æ„è¦‹ã€‚<span class='ab-en'>Listen to others.</span>",
    "è§€å¯Ÿåˆ¥äººçš„åšæ³•ã€‚<span class='ab-en'>Observe others.</span>",
    "ä½ éœ€è¦ä¸€å€‹å¤¥ä¼´ã€‚<span class='ab-en'>You need a partner.</span>",
    "ä¿¡ä»»ä½ çš„å°å¸«ã€‚<span class='ab-en'>Trust your mentor.</span>",
    "é€™èˆ‡æŸå€‹ä½ èªè­˜çš„äººæœ‰é—œã€‚<span class='ab-en'>It involves someone you know.</span>",
    "ä½ æœƒåœ¨å°è©±ä¸­æ‰¾åˆ°ç­”æ¡ˆã€‚<span class='ab-en'>Answer lies in conversation.</span>",
    "å»è®€æ›¸ã€‚<span class='ab-en'>Read a book.</span>",
    "æ³¨æ„è·¯æ¨™ã€‚<span class='ab-en'>Watch the signs.</span>",
    "é€™éœ€è¦åœ˜éšŠåˆä½œã€‚<span class='ab-en'>Teamwork required.</span>",
    "æ¥å—åˆ¥äººçš„å¥½æ„ã€‚<span class='ab-en'>Accept the kindness.</span>",
    "æœ‰äººæ­£åœ¨æƒ³å¿µä½ ã€‚<span class='ab-en'>Someone is missing you.</span>",
    "å»è¦‹è¦‹è€æœ‹å‹ã€‚<span class='ab-en'>See an old friend.</span>",
    "é€™å–æ±ºæ–¼ä»–äººã€‚<span class='ab-en'>It depends on others.</span>",
    "ä½ å¿½ç•¥äº†æŸå€‹äººçš„æ„Ÿå—ã€‚<span class='ab-en'>You ignored someone's feelings.</span>",
    "é€™èˆ‡å®¶åº­æœ‰é—œã€‚<span class='ab-en'>It is about family.</span>",
    "ä½ éœ€è¦é™ªä¼´ã€‚<span class='ab-en'>You need company.</span>",
    "é€™ä¸æ˜¯ä½ ä¸€å€‹äººçš„äº‹ã€‚<span class='ab-en'>It's not just about you.</span>",
    "å»å°‹æ‰¾æŒ‡å¼•ã€‚<span class='ab-en'>Seek guidance.</span>",
    "é€™éœ€è¦æºé€šã€‚<span class='ab-en'>Communication is needed.</span>",
    "é€™èˆ‡ä¸€æ®µé—œä¿‚æœ‰é—œã€‚<span class='ab-en'>It's about a relationship.</span>",
    "ä½ çš„å°æ‰‹æœƒå‘Šè¨´ä½ ç­”æ¡ˆã€‚<span class='ab-en'>Your rival holds the answer.</span>",
    "ä½ éœ€è¦å°ˆæ¥­å»ºè­°ã€‚<span class='ab-en'>Get professional advice.</span>",
    "ä¿¡ä»»é‚£å€‹æ„›ä½ çš„äººã€‚<span class='ab-en'>Trust the one who loves you.</span>",
    "é€™éœ€è¦å¦¥å”ã€‚<span class='ab-en'>Compromise is needed.</span>",

    // --- å…§åœ¨åæ€ (Reflection) ---
    "ç­”æ¡ˆå°±åœ¨ä½ å¿ƒä¸­ã€‚<span class='ab-en'>The answer is within you.</span>",
    "ä½ å…¶å¯¦å·²ç¶“çŸ¥é“ç­”æ¡ˆäº†ã€‚<span class='ab-en'>You already know the answer.</span>",
    "èª å¯¦é¢å°è‡ªå·±ã€‚<span class='ab-en'>Be honest with yourself.</span>",
    "é€™å°ä½ é‡è¦å—ï¼Ÿ<span class='ab-en'>Is this important to you?</span>",
    "ä½ åœ¨é€ƒé¿ä»€éº¼ï¼Ÿ<span class='ab-en'>What are you avoiding?</span>",
    "é€™çœŸçš„è®“ä½ å¿«æ¨‚å—ï¼Ÿ<span class='ab-en'>Does this truly make you happy?</span>",
    "å‚¾è½å…§åœ¨çš„è²éŸ³ã€‚<span class='ab-en'>Listen to your inner voice.</span>",
    "é€™èˆ‡ä½ çš„ææ‡¼æœ‰é—œã€‚<span class='ab-en'>It is related to your fear.</span>",
    "é‡æ–°è©•ä¼°ä½ çš„åƒ¹å€¼è§€ã€‚<span class='ab-en'>Re-evaluate your values.</span>",
    "é€™åªæ˜¯ä¸€å€‹éæ¸¡æœŸã€‚<span class='ab-en'>It is just a phase.</span>",
    "ä½ åœ¨å°‹æ‰¾å®‰å…¨æ„Ÿã€‚<span class='ab-en'>You are seeking safety.</span>",
    "é€™èˆ‡éå»æœ‰é—œã€‚<span class='ab-en'>It is about the past.</span>",
    "æ”¾ä¸‹åŸ·å¿µã€‚<span class='ab-en'>Let go of attachment.</span>",
    "ä½ éœ€è¦åŸè«’ã€‚<span class='ab-en'>You need to forgive.</span>",
    "é€™æ˜¯ä¸€å€‹å­¸ç¿’çš„æ©Ÿæœƒã€‚<span class='ab-en'>It is a learning opportunity.</span>",
    "ä½ åœ¨æ¬ºé¨™è‡ªå·±ã€‚<span class='ab-en'>You are fooling yourself.</span>",
    "é€™ä¸æ˜¯é‡é»ã€‚<span class='ab-en'>That is not the point.</span>",
    "ä½ çš„å‹•æ©Ÿæ˜¯ä»€éº¼ï¼Ÿ<span class='ab-en'>What is your motive?</span>",
    "é€™èˆ‡é‡‘éŒ¢ç„¡é—œã€‚<span class='ab-en'>It is not about money.</span>",
    "å°ˆæ³¨æ–¼ç•¶ä¸‹ã€‚<span class='ab-en'>Focus on the present.</span>",
    "é€™æ˜¯ä¸€å€‹è€ƒé©—ã€‚<span class='ab-en'>It is a test.</span>",
    "ä½ åœ¨é‡è¤‡èˆŠçš„æ¨¡å¼ã€‚<span class='ab-en'>You are repeating patterns.</span>",
    "é€™èˆ‡ä½ çš„ç«¥å¹´æœ‰é—œã€‚<span class='ab-en'>It relates to your childhood.</span>",
    "ä½ éœ€è¦ç™‚ç™’ã€‚<span class='ab-en'>You need healing.</span>",
    "é€™æ˜¯ä¸€å€‹ä¿¡è™Ÿã€‚<span class='ab-en'>This is a sign.</span>",
    "æ”¹è®Šä½ çš„è§€é»ã€‚<span class='ab-en'>Change your perspective.</span>",
    "é€™åªæ˜¯ä¸€å€‹å¹»è¦ºã€‚<span class='ab-en'>It is just an illusion.</span>",
    "ä½ éœ€è¦å‹‡æ°£ã€‚<span class='ab-en'>You need courage.</span>",
    "é€™èˆ‡ä½ çš„è‡ªå°Šæœ‰é—œã€‚<span class='ab-en'>It is about your self-esteem.</span>",
    "ä½ åœ¨å°‹æ‰¾èªåŒã€‚<span class='ab-en'>You are seeking approval.</span>",
    "é€™æ˜¯ä¸€å€‹è½‰æ©é»ã€‚<span class='ab-en'>This is a turning point.</span>",
    "é€™èˆ‡æ„›æœ‰é—œã€‚<span class='ab-en'>It is about love.</span>",
    "ä½ éœ€è¦é‡‹æ”¾æƒ…ç·’ã€‚<span class='ab-en'>Release your emotions.</span>",
    "é€™æ˜¯ä¸€å€‹å¾ªç’°ã€‚<span class='ab-en'>It is a cycle.</span>",
    "ä½ åœ¨å°‹æ‰¾æ„ç¾©ã€‚<span class='ab-en'>You are searching for meaning.</span>",
    "é€™èˆ‡è‡ªç”±æœ‰é—œã€‚<span class='ab-en'>It is about freedom.</span>",

    // --- æ¨¡ç³Šèˆ‡ç¥ç¥• (Ambiguous & Mystic) ---
    "ä¹Ÿè¨±ã€‚<span class='ab-en'>Maybe.</span>",
    "é€™å¾ˆè¤‡é›œã€‚<span class='ab-en'>It is complicated.</span>",
    "çµæœæœªå®šã€‚<span class='ab-en'>Outcome is uncertain.</span>",
    "é€™å–æ±ºæ–¼ä½ ã€‚<span class='ab-en'>It depends on you.</span>",
    "é€™æ˜¯ä¸€å€‹è¬ã€‚<span class='ab-en'>It is a mystery.</span>",
    "é€™ç„¡æ³•é æ¸¬ã€‚<span class='ab-en'>It is unpredictable.</span>",
    "ä½ éœ€è¦å†’éšªã€‚<span class='ab-en'>You need to adventure.</span>",
    "é€™æ˜¯ä¸€å€‹é©šå–œã€‚<span class='ab-en'>It is a surprise.</span>",
    "é€™æ˜¯ä¸€å€‹ç§˜å¯†ã€‚<span class='ab-en'>It is a secret.</span>",
    "é€™æ˜¯ä¸€å€‹å¥‡è¹Ÿã€‚<span class='ab-en'>It is a miracle.</span>",
    "é€™æ˜¯ä¸€å€‹é–‹å§‹ã€‚<span class='ab-en'>It is a beginning.</span>",
    "é€™æ˜¯ä¸€å€‹çµæŸã€‚<span class='ab-en'>It is an end.</span>",
    "é€™æ˜¯ä¸€å€‹å¾ªç’°ã€‚<span class='ab-en'>It is a loop.</span>",
    "é€™æ˜¯ä¸€å€‹å¤¢ã€‚<span class='ab-en'>It is a dream.</span>",
    "é€™æ˜¯ä¸€å€‹éŠæˆ²ã€‚<span class='ab-en'>It is a game.</span>",
    "é€™æ˜¯ä¸€å€‹ç¦®ç‰©ã€‚<span class='ab-en'>It is a gift.</span>",
    "é€™æ˜¯ä¸€å€‹è² æ“”ã€‚<span class='ab-en'>It is a burden.</span>",
    "é€™æ˜¯ä¸€å€‹è²¬ä»»ã€‚<span class='ab-en'>It is a responsibility.</span>",
    "é€™æ˜¯ä¸€å€‹æŒ‘æˆ°ã€‚<span class='ab-en'>It is a challenge.</span>",
    "é€™æ˜¯ä¸€å€‹æ©Ÿæœƒã€‚<span class='ab-en'>It is an opportunity.</span>",
    "é€™æ˜¯ä¸€å€‹é™·é˜±ã€‚<span class='ab-en'>It is a trap.</span>",
    "é€™æ˜¯ä¸€å€‹æ¸¬è©¦ã€‚<span class='ab-en'>It is a test.</span>",
    "é€™æ˜¯ä¸€å€‹ç©ç¬‘ã€‚<span class='ab-en'>It is a joke.</span>",
    "é€™æ˜¯ä¸€å€‹è­¦å‘Šã€‚<span class='ab-en'>It is a warning.</span>",
    "é€™æ˜¯ä¸€å€‹ç¥ç¦ã€‚<span class='ab-en'>It is a blessing.</span>",
    "é€™æ˜¯ä¸€å€‹è©›å’’ã€‚<span class='ab-en'>It is a curse.</span>",
    "é€™æ˜¯ä¸€å€‹æ‰¿è«¾ã€‚<span class='ab-en'>It is a promise.</span>",
    "é€™æ˜¯ä¸€å€‹è¬Šè¨€ã€‚<span class='ab-en'>It is a lie.</span>",
    "é€™æ˜¯ä¸€å€‹çœŸç›¸ã€‚<span class='ab-en'>It is the truth.</span>",
    "é€™æ˜¯ä¸€å€‹èª¤æœƒã€‚<span class='ab-en'>It is a misunderstanding.</span>",
    "é€™æ˜¯ä¸€å€‹å·§åˆã€‚<span class='ab-en'>It is a coincidence.</span>",
    "é€™æ˜¯ä¸€å€‹å‘½é‹ã€‚<span class='ab-en'>It is fate.</span>",
    "æ›å€‹è§’åº¦çœ‹ã€‚<span class='ab-en'>Look from another angle.</span>",
    "ä¸€ç¬‘ç½®ä¹‹ã€‚<span class='ab-en'>Laugh it off.</span>",
    "æ•¸åˆ°åã€‚<span class='ab-en'>Count to ten.</span>",
    "æ·±å‘¼å¸ã€‚<span class='ab-en'>Take a deep breath.</span>",
    "çœ‹å‘çª—å¤–ã€‚<span class='ab-en'>Look out the window.</span>",
    "æ•´ç†ä½ çš„æˆ¿é–“ã€‚<span class='ab-en'>Clean your room.</span>",
    "å–æ¯æ°´ã€‚<span class='ab-en'>Drink some water.</span>",
    "å‡ºå»èµ°èµ°ã€‚<span class='ab-en'>Go for a walk.</span>",
    "å¯«ä¸‹ä¾†ã€‚<span class='ab-en'>Write it down.</span>",
    "æŠŠå®ƒç•«å‡ºä¾†ã€‚<span class='ab-en'>Draw it out.</span>",
    "å”±é¦–æ­Œã€‚<span class='ab-en'>Sing a song.</span>",
    "è·³æ”¯èˆã€‚<span class='ab-en'>Dance.</span>",
    "ä¿æŒæ²‰é»˜ã€‚<span class='ab-en'>Stay silent.</span>",
    "å¤§è²èªªå‡ºä¾†ã€‚<span class='ab-en'>Say it out loud.</span>",
    "é–‰ä¸Šçœ¼ç›ã€‚<span class='ab-en'>Close your eyes.</span>",
    "å¼µé–‹é›™æ‰‹ã€‚<span class='ab-en'>Open your arms.</span>",
    "é€™æ²’ä»€éº¼å¤§ä¸äº†çš„ã€‚<span class='ab-en'>No big deal.</span>",
    "é€™å¾ˆé‡è¦ã€‚<span class='ab-en'>This is important.</span>",
    "é€™å¾®ä¸è¶³é“ã€‚<span class='ab-en'>It is trivial.</span>",
    "é€™æ„ç¾©é‡å¤§ã€‚<span class='ab-en'>It means a lot.</span>",
    "é€™å¾ˆå¯ç¬‘ã€‚<span class='ab-en'>It is ridiculous.</span>",
    "é€™å¾ˆåš´è‚…ã€‚<span class='ab-en'>It is serious.</span>",
    "é€™å¾ˆç°¡å–®ã€‚<span class='ab-en'>It is simple.</span>",
    "é€™å¾ˆå›°é›£ã€‚<span class='ab-en'>It is hard.</span>",

    // --- æœå°ˆå±¬å½©è›‹ (Easter Eggs) ---
    "å¦‚æœå¥‡è¹Ÿç™¼ç”Ÿäº†...<span class='ab-en'>If a miracle happened...</span>",
    "è©¦è‘—å¤–åŒ–é€™å€‹å•é¡Œã€‚<span class='ab-en'>Externalize the problem.</span>",
    "ä½ çš„ä¾‹å¤–ç¶“é©—åœ¨å“ªè£¡ï¼Ÿ<span class='ab-en'>Where are your exceptions?</span>",
    "é€™æ˜¯ä¸€å€‹ç¨ç‰¹çµæœã€‚<span class='ab-en'>This is a unique outcome.</span>",
    "ç…§é¡§å¥½ä½ çš„å…§åœ¨å°å­©ã€‚<span class='ab-en'>Care for your inner child.</span>",
    "é€™éœ€è¦ç³»çµ±è§€ã€‚<span class='ab-en'>Think systemically.</span>",
    "åˆ¥å¿˜äº†ä½ çš„åˆè¡·ã€‚<span class='ab-en'>Remember why you started.</span>",
    "é€™ä¹Ÿæ˜¯ä¸€ç¨®è¤‡åˆ©æ•ˆæ‡‰ã€‚<span class='ab-en'>This is compound interest.</span>",
    "ä½ çš„è‚Œè‚‰è¨˜å¾—ã€‚<span class='ab-en'>Your muscles remember.</span>",
    "é€™éœ€è¦åˆ»æ„ç·´ç¿’ã€‚<span class='ab-en'>It takes deliberate practice.</span>",
    "é€™æ˜¯ä½ çš„è‹±é›„ä¹‹æ—…ã€‚<span class='ab-en'>This is your Hero's Journey.</span>",
    "ä½ çš„æ•…äº‹ç”±ä½ æ”¹å¯«ã€‚<span class='ab-en'>Rewrite your story.</span>"
];

    // 2. æ¸²æŸ“ HTML
    contentArea.innerHTML = `
        <div class="ab-container">
            <div class="ab-book" id="ab-book">
                <div class="ab-spine">
                    <span class="ab-spine-text">THE BOOK OF ANSWERS</span>
                </div>

                <div class="ab-cover-group">
                    <div class="ab-cover-front">
                        <div class="ab-star-icon">
                            <div class="ab-star-center"></div>
                        </div>
                        <div class="ab-cover-title-en">The Book<br>of Answers</div>
                        <div class="ab-cover-title-zh">é»˜å¿µå•é¡Œ Â· è¼•è§¸æ­ç¤º</div>
                    </div>
                    <div class="ab-cover-back"></div>
                </div>

                <div class="ab-pages">
                    <div class="ab-content-box">
                        <div class="ab-answer-text" id="ab-text">...</div>
                    </div>
                </div>
            </div>
            
            <div class="ab-hint">é»æ“Šæ›¸æœ¬ç¿»é </div>
        </div>
    `;

    // 3. ç¶å®šäº‹ä»¶
    const book = contentArea.querySelector('#ab-book');
    const textEl = contentArea.querySelector('#ab-text');
    let lastIndex = -1;

    book.addEventListener('click', () => {
        if (book.classList.contains('is-open')) {
            book.classList.remove('is-open');
            setTimeout(() => { textEl.innerHTML = '...'; }, 600);
        } else {
            let randomIndex;
            if (ab_answers.length > 1) {
                do {
                    randomIndex = Math.floor(Math.random() * ab_answers.length);
                } while (randomIndex === lastIndex);
            } else {
                randomIndex = 0;
            }
            lastIndex = randomIndex;
            textEl.innerHTML = ab_answers[randomIndex];
            book.classList.add('is-open');
        }
    });
},
    // é è¨­ç•«é¢ (çµ¦å…¶ä»–é‚„æ²’åšå¥½çš„åŠŸèƒ½ç”¨)
    renderDefault: (container) => {
        container.innerHTML = `
             <p style="font-size: 1.1rem; color: var(--text-sub);">âœ¨ è¼•è¼•åœ°å¸æ°£ï¼Œæ…¢æ…¢åœ°åæ°£ âœ¨</p>
             <p style="font-size: 0.9rem; color: #CCC; margin-top:10px;">(æ­¤åŠŸèƒ½å»ºç½®ä¸­)</p>
        `;
    }
};

/* =========================================
   2. ä¿®æ”¹åŸæœ¬çš„ openFeature å‡½å¼ (æ ¸å¿ƒå¤§è…¦)
   ========================================= */
// è¨˜å¾—å…ˆæŠ“åˆ°é€™å…©å€‹å…ƒç´ 
const modal = document.getElementById('active-feature-container');
const featureTitle = document.getElementById('feature-title-display');
const contentArea = document.getElementById('feature-content-area'); // é€™æ˜¯ä½ åŸæœ¬ HTML è£¡çš„é‚£å€‹ div

function openFeature(feature) {
    // 1. æ‰“é–‹è¦–çª—
    modal.style.display = 'flex';
    
    // 2. è¨­å®šæ¨™é¡Œ
    featureTitle.innerText = feature.name;
    
// é€™æ˜¯åŸæœ¬ä½ å¯«é‚£ä¸€é•·ä¸² if-else çš„åœ°æ–¹ï¼Œè«‹æ”¹æˆä¸‹é¢é€™æ¨£ï¼š

// 1. å®šç¾©ä¸€å€‹å°å·¥å…·ï¼ŒæŠŠ "answer_book" è½‰æˆ "AnswerBook"
// (é€™æ®µ regex çœ‹ä¸æ‡‚æ²’é—œä¿‚ï¼Œå®ƒå°±æ˜¯è² è²¬æŠŠåº•ç·šæ‹¿æ‰ï¼Œå¾Œé¢çš„å­—æ¯è®Šå¤§å¯«)
const featureName = feature.id
    .toLowerCase()
    .replace(/_(\w)/g, (all, letter) => letter.toUpperCase()) // answerBook
    .replace(/^\w/, c => c.toUpperCase()); // AnswerBook

// 2. æ‹¼æ¹Šå‡ºç›®æ¨™å‡½æ•¸çš„åç¨±ï¼š "render" + "AnswerBook" = "renderAnswerBook"
const targetRendererName = `render${featureName}`;

// 3. æª¢æŸ¥ renderers è£¡é¢æœ‰æ²’æœ‰é€™å€‹å‡½æ•¸ï¼Ÿ
if (typeof renderers[targetRendererName] === 'function') {
    // âœ… è‡ªå‹•æ‰¾åˆ°å°æ‡‰å‡½æ•¸ (ç„¡è«–æ˜¯ renderDbtCards é‚„æ˜¯ renderAnswerBook)
    renderers[targetRendererName](contentArea);
} else {
    // âŒ æ‰¾ä¸åˆ°å°±é¡¯ç¤ºå»ºç½®ä¸­
    renderers.renderDefault(contentArea);
}

    // 4. æ­·å²ç´€éŒ„
    history.pushState({ type: 'modal' }, null, "#feature");
}
        
        // è™•ç†è¿”å›éµé‚è¼¯ (Settings & Features)
        window.addEventListener('popstate', function(event) {
            // 1. å¦‚æœè¨­å®š Modal é–‹è‘—ï¼Œå°±é—œæ‰
            if (settingsModal.classList.contains('show')) {
                settingsModal.classList.remove('show');
                setTimeout(() => { settingsModal.style.display = 'none'; }, 300);
                return;
            }

            // 2. å¦‚æœåŠŸèƒ½ Modal é–‹è‘—ï¼Œå°±é—œæ‰
            if (modal.style.display === 'flex') {
                modal.style.display = 'none';
                return;
            }
            
            // 3. å…¶ä»–æƒ…æ³é‡ç½®ç¯©é¸
            resetAllFilters();
        });


        // ============================================
        // 3. éºµåœ˜ç²¾éˆç³»çµ±
        // ============================================
        
        let petMoveInterval;
        let isDragging = false;
        let audioCtx = null;
        let speechTimeout;
        let lastInteractionTime = 0;

        const comfortMessages = [
            'è¨˜å¾—å–æ°´å–” <span class="kaomoji">( Ë˜ Â³Ë˜)â™¥</span>', 
            'æ·±å‘¼å¸ï½ <span class="kaomoji">( Â´ â–½ ` )ï¾‰</span>', 
            'æˆ‘åœ¨é€™è£¡é™ªä½  <span class="kaomoji">(Â´â€¢ Ï‰ â€¢`)</span>', 
            'ä½ åšå¾—å¾ˆå¥½ <span class="kaomoji">(à¹‘â€¢Ì€ã…‚â€¢Ì)Ùˆâœ§</span>', 
            'ä¼‘æ¯ä¸€ä¸‹å§ <span class="kaomoji">_(:3 ã€âˆ  )_</span>', 
            'æ…¢æ…¢ä¾† <span class="kaomoji">(ãƒ»âˆ€ãƒ»)</span>', 
            'æ”¾è¼•é¬†ï½ <span class="kaomoji">(ï¿£â–½ï¿£)~*</span>', 
            'æ„Ÿå—ç•¶ä¸‹ <span class="kaomoji">(âÂ´â—¡`â)</span>', 
            'æŠ±æŠ± <span class="kaomoji">(ã¤Â´Ï‰`)ã¤</span>'
        ];

        function initPetSystem() {
            const savedX = localStorage.getItem('petX');
            const savedY = localStorage.getItem('petY');
            
            if (savedX && savedY) {
                petEl.style.left = savedX + 'px';
                petEl.style.top = savedY + 'px';
            } else {
                petEl.style.left = (window.innerWidth - 100) + 'px';
                petEl.style.top = '100px';
            }

            setupPetInteraction();
            updatePetVisibility();
            if (isPetActive) startPetBehavior();
        }

        function updatePetVisibility() {
            if (isPetActive) {
                petEl.style.display = 'block';
                startPetBehavior();
                showSpeech('æˆ‘å›ä¾†äº†ï¼', 2000);
            } else {
                petEl.style.display = 'none';
                stopPetBehavior();
            }
        }

        function startPetBehavior() {
            clearInterval(petMoveInterval);
            petMoveInterval = setInterval(() => {
                if(!isDragging) movePetRandomly();
            }, 12000);
        }

        function stopPetBehavior() {
            clearInterval(petMoveInterval);
        }

        function movePetRandomly() {
            petEl.classList.add('auto-moving');
            const maxX = window.innerWidth - 90;
            const maxY = window.innerHeight - 90;
            const randomX = Math.max(20, Math.random() * maxX);
            const randomY = Math.max(80, Math.random() * maxY);

            petEl.style.left = randomX + 'px';
            petEl.style.top = randomY + 'px';

            localStorage.setItem('petX', randomX);
            localStorage.setItem('petY', randomY);
        }

        function setupPetInteraction() {
            let startX, startY, initialLeft, initialTop, moveDistance = 0;

            const startDrag = (e) => {
                if(!isPetActive) return;
                isDragging = true;
                petEl.classList.remove('auto-moving'); 
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                startX = clientX; startY = clientY;
                initialLeft = petEl.offsetLeft; initialTop = petEl.offsetTop;
                moveDistance = 0;
                resumeAudioContext(); 
            };

            const doDrag = (e) => {
                if (!isDragging) return;
                e.preventDefault(); 
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                const dx = clientX - startX;
                const dy = clientY - startY;
                moveDistance += Math.abs(dx) + Math.abs(dy);
                petEl.style.left = (initialLeft + dx) + 'px';
                petEl.style.top = (initialTop + dy) + 'px';
            };

            const endDrag = (e) => {
                if (!isDragging) return;
                isDragging = false;
                localStorage.setItem('petX', parseInt(petEl.style.left));
                localStorage.setItem('petY', parseInt(petEl.style.top));
                if (moveDistance < 10) {
                    const now = Date.now();
                    if (now - lastInteractionTime > 300) { 
                        triggerInteraction();
                        lastInteractionTime = now;
                    }
                }
            };
            petEl.addEventListener('mousedown', startDrag);
            window.addEventListener('mousemove', doDrag);
            window.addEventListener('mouseup', endDrag);
            petEl.addEventListener('touchstart', startDrag, {passive: false});
            window.addEventListener('touchmove', doDrag, {passive: false});
            window.addEventListener('touchend', endDrag);
        }

        function triggerInteraction() {
            if (navigator.vibrate) navigator.vibrate(50);
            if (isSfxOn) playExhaleSound();
            const body = petEl.querySelector('.pet-svg-body');
            body.classList.remove('pet-shake');
            void petEl.offsetWidth; 
            body.classList.add('pet-shake');
            const msg = comfortMessages[Math.floor(Math.random() * comfortMessages.length)];
            showSpeech(msg, 3500);
        }

        function showSpeech(text, duration) {
            if (speechTimeout) clearTimeout(speechTimeout);
            const petSpeech = document.getElementById('pet-speech');
            petSpeech.innerHTML = text; 
            petSpeech.classList.add('show');
            speechTimeout = setTimeout(() => {
                petSpeech.classList.remove('show');
            }, duration);
        }

        // ============================================
        // 4. éŸ³æ•ˆç³»çµ± (Audio System)
        // ============================================

        let bgmTimeout;
        let lastFreq = 220; 
        const scaleFreqs = [130.81, 146.83, 164.81, 196.00, 220.00, 261.63, 293.66, 329.63, 392.00, 440.00];

        function resumeAudioContext() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playExhaleSound() {
            if(!isSfxOn) return;
            resumeAudioContext();
            const duration = 4.0; 
            const bufferSize = audioCtx.sampleRate * duration;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(400, audioCtx.currentTime);
            filter.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + duration);
            const gainNode = audioCtx.createGain();
            gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.15, audioCtx.currentTime + 0.5); 
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration); 
            noise.connect(filter); filter.connect(gainNode); gainNode.connect(audioCtx.destination);
            noise.start(); noise.stop(audioCtx.currentTime + duration);
        }

        function playNextNote() {
            if (!isMusicOn) return;
            resumeAudioContext();

            // é¸æ“‡éŸ³é«˜é‚è¼¯
            let possibleIndices = [];
            const currentIdx = scaleFreqs.indexOf(lastFreq);
            [-2, -1, 1, 2].forEach(step => {
                const idx = currentIdx + step;
                if (idx >= 0 && idx < scaleFreqs.length) possibleIndices.push(idx);
            });
            if (possibleIndices.length === 0) possibleIndices = [3, 4, 5, 6];
            const nextIdx = possibleIndices[Math.floor(Math.random() * possibleIndices.length)];
            const freq = scaleFreqs[nextIdx];
            lastFreq = freq;

            // ç”¢ç”Ÿè²éŸ³
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const filter = audioCtx.createBiquadFilter(); 
            osc.type = 'triangle';
            osc.frequency.value = freq;
            filter.type = 'lowpass';
            filter.frequency.value = 400; 
            const now = audioCtx.currentTime;
            const duration = 10.0; 
            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(0.08, now + 1.0); 
            gain.gain.exponentialRampToValueAtTime(0.001, now + duration); 
            osc.connect(filter); filter.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(now + duration);

            // é ç´„ä¸‹ä¸€å€‹éŸ³ (éš¨æ©Ÿ +1ç§’é‚è¼¯å·²åŒ…å«)
            const nextTime = 2000 + Math.random() * 1500;
            bgmTimeout = setTimeout(playNextNote, nextTime);
        }

        // å•Ÿå‹•
        initApp();
        
    </script>
</body>
</html>
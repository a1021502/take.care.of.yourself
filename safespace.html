<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒéˆæ€¥æ•‘ç®±</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@300;400;500&family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* --- ğŸ¨ ç²¾ç·»åŒ–è¦–è¦ºç³»çµ± (Refined & Healing Palette) --- */
        :root {
            /* è«è˜­è¿ªç¶ è‰²ç³»ï¼šä½é£½å’Œï¼Œæ›´è€çœ‹ã€é«˜ç´š */
            --primary: #6A8E7F;       /* ä¸»è‰²ï¼šä¹¾ç‡¥é¼ å°¾è‰ç¶  */
            --primary-dark: #4A665A;  /* æ·±è‰²ï¼šç”¨æ–¼æ–‡å­—å¼·èª¿ */
            --primary-soft: #E8F1ED;  /* æ·ºè‰²ï¼šèƒŒæ™¯é»ç¶´ */
            
            --bg: #FAF9F6;            /* èƒŒæ™¯ï¼šç‡•éº¥å¥¶ç™½ (æ¯”ç´”ç™½æ›´è­·çœ¼) */
            --card-bg: #FFFFFF;
            --text-main: #5C5552;     /* æ·±æš–ç° */
            --text-sub: #9E9894;      /* æ·ºæš–ç° */
            
            --accent-warm: #D48C84;   /* è±†æ²™ç´… (æ„›å¿ƒç”¨) */
            
            /* é«˜ç´šæ„Ÿé™°å½±ï¼šæ“´æ•£ç¯„åœå¤§ï¼Œé¡è‰²æ·¡ */
            --shadow-card: 0 10px 25px -5px rgba(106, 142, 127, 0.15); 
            --shadow-float: 0 15px 30px -5px rgba(106, 142, 127, 0.25);
            
            --radius-box: 24px;       /* æ›´åœ“æ½¤çš„å°è§’ */
            --radius-btn: 50px;
        }

        body {
            /* å…§æ–‡ä½¿ç”¨åœ“é«”ï¼Œç¢ºä¿æ˜“è®€æ€§ */
            font-family: "Zen Maru Gothic", sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            line-height: 1.7;
            /* éš±ç´„çš„ç´™å¼µç´‹ç†èƒŒæ™¯ */
            background-image: radial-gradient(#E0E0E0 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* ç‰¹æ®Šå­—é«” classï¼šç”¨æ–¼æ¨™é¡Œï¼Œç‡Ÿé€ ç¹ªæœ¬æ„Ÿ */
        .serif-font {
            font-family: "Kiwi Maru", serif;
            font-weight: 500;
        }

        /* --- Header å€åŸŸ --- */
        header { 
            text-align: center; 
            margin-bottom: 32px; 
            margin-top: 20px;
            position: relative; 
        }
        
        h1 { 
            font-family: "Kiwi Maru", serif; 
            font-weight: 500; 
            font-size: 2.6rem;
            margin: 0; 
            color: var(--primary); 
            letter-spacing: 0.05em;
            text-shadow: 2px 2px 0px rgba(255,255,255,0.8); /* æ–‡å­—ç™½é‚Šï¼Œå¢åŠ å±¤æ¬¡ */
        }
        
        p.subtitle { 
            font-size: 1.05rem; 
            color: var(--text-sub); 
            margin-top: 8px; 
            letter-spacing: 0.02em;
        }

        /* --- ğŸ” æœå°‹æ¬„ (æ‡¸æµ®è† å›Šè¨­è¨ˆ) --- */
        .search-container {
            width: 100%;
            max-width: 500px;
            margin-bottom: 28px;
            position: relative;
        }
        #search-input {
            width: 100%;
            padding: 18px 28px;
            border-radius: var(--radius-btn);
            border: 1px solid rgba(255,255,255,0.5); /* åŠé€æ˜é‚Šæ¡† */
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px); /* æ¯›ç»ç’ƒç‰¹æ•ˆ */
            font-size: 1rem;
            font-family: "Zen Maru Gothic", sans-serif;
            color: var(--text-main);
            outline: none;
            box-shadow: var(--shadow-card);
            box-sizing: border-box;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        #search-input:focus {
            border-color: var(--primary);
            box-shadow: var(--shadow-float);
            transform: translateY(-2px);
        }
        #search-input::placeholder {
            color: #C2BFBC;
        }

        /* --- ğŸš‘ æƒ…ç·’å¿«ç¯©å€ (æŸ”å’Œè‰²å¡Š) --- */
        .triage-section {
            width: 100%;
            max-width: 500px;
            background: linear-gradient(135deg, #F3F8F5 0%, #E8F1ED 100%); /* å¾®æ¼¸å±¤ */
            padding: 24px;
            border-radius: var(--radius-box);
            margin-bottom: 32px;
            text-align: center;
            box-sizing: border-box;
            box-shadow: inset 0 0 0 1px rgba(255,255,255,0.8); /* å…§ç™¼å…‰è³ªæ„Ÿ */
        }
        .triage-title { 
            font-family: "Kiwi Maru", serif;
            font-size: 1.25rem; 
            margin-bottom: 16px; 
            color: var(--primary-dark);
        }
        .mood-tags { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        
        .mood-btn {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid transparent;
            color: var(--text-main);
            padding: 8px 18px;
            border-radius: var(--radius-btn);
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
            font-family: "Zen Maru Gothic", sans-serif;
            font-weight: 500;
        }
        .mood-btn:hover {
            transform: translateY(-2px);
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        /* é¸ä¸­ç‹€æ…‹ */
        .mood-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(106, 142, 127, 0.4);
            transform: translateY(-1px);
        }
        /* æœ€æ„›æŒ‰éˆ•ç‰¹åˆ¥æ¨£å¼ */
        .mood-btn.fav-filter { color: var(--accent-warm); border: 1px solid rgba(212, 140, 132, 0.2); }
        .mood-btn.fav-filter.active { background: var(--accent-warm); color: white; border-color: var(--accent-warm); }

        /* --- ğŸ› ï¸ å·¥å…·ç®±åˆ—è¡¨ (å¡ç‰‡è¨­è¨ˆ) --- */
        .toolbox-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* å¼·åˆ¶å…©æ¬„ */
            gap: 20px;
            width: 100%;
            max-width: 500px;
            padding-bottom: 40px;
        }

        .feature-card {
            background: var(--card-bg);
            border-radius: var(--radius-box);
            padding: 24px 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: var(--shadow-card);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); /* å½ˆæ€§å‹•ç•« */
            height: 150px;
            position: relative;
            border: 1px solid rgba(255,255,255,0.8);
        }
        
        .feature-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: var(--shadow-float);
        }
        .feature-card:active { transform: scale(0.97); }
        
        .card-icon { 
            font-size: 2.8rem; 
            margin-bottom: 12px; 
            /* è®“ emoji ç¨å¾®é€æ˜ä¸€é»ï¼Œèåˆç•«é¢ */
            opacity: 0.9; 
            filter: sepia(0.2); /* è®“ emoji è‰²èª¿ç¨å¾®å¾©å¤ä¸€é» */
        }
        
        .card-title { 
            font-family: "Kiwi Maru", serif; 
            font-size: 1.15rem; 
            color: var(--text-main);
            font-weight: 500;
            line-height: 1.3;
        }
        .card-tag { 
            font-size: 0.8rem; 
            color: #B0B0B0; 
            margin-top: 6px; 
            font-weight: 400;
        }

        /* --- â¤ï¸ æ„›å¿ƒæ”¶è—æŒ‰éˆ• --- */
        .favorite-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            font-size: 1.3rem;
            color: #ECECEC; /* æœªæ”¶è—æ™‚çš„é¡è‰²ï¼Œéå¸¸æ·¡ï¼Œä¸å¹²æ“¾ */
            cursor: pointer;
            transition: all 0.3s;
            z-index: 10;
            padding: 5px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.05));
        }
        .favorite-btn:hover { transform: scale(1.15); color: #F2CFCB; }
        .favorite-btn.is-active {
            color: var(--accent-warm); /* è±†æ²™ç´… */
            animation: heartPop 0.4s ease;
        }
        @keyframes heartPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.4); }
            100% { transform: scale(1); }
        }

        /* --- æ‰¾ä¸åˆ°çµæœ --- */
        .no-result {
            grid-column: span 2;
            text-align: center;
            color: var(--text-sub);
            padding: 40px;
            font-family: "Kiwi Maru", serif;
            font-size: 1.1rem;
            background: rgba(255,255,255,0.5);
            border-radius: var(--radius-box);
        }

        /* --- ğŸ“± åŠŸèƒ½ç•«é¢ (å…¨è¢å¹•è¦†è“‹å±¤) --- */
        #active-feature-container {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg);
            z-index: 1000;
            display: none;
            flex-direction: column;
            padding: 24px;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .close-btn {
            align-self: flex-end;
            padding: 10px 24px;
            background: #EBEAE6;
            border-radius: var(--radius-btn);
            border: none;
            cursor: pointer;
            font-family: "Zen Maru Gothic", sans-serif;
            font-size: 1rem;
            color: var(--text-main);
            transition: all 0.2s;
        }
        .close-btn:hover { background: #E0DFDB; }

    </style>
</head>
<body>

    <header>
        <h1>Safe Space</h1>
        <p class="subtitle serif-font">åœ¨é€™è£¡ï¼Œä½ ä¸éœ€è¦å‹‰å¼·è‡ªå·±ã€‚</p>
    </header>

    <div class="search-container">
        <input type="text" id="search-input" placeholder="ğŸ” æœå°‹ï¼šå¡”ç¾…ã€å‘¼å¸ã€è¿·æƒ˜...">
    </div>

    <section class="triage-section">
        <div class="triage-title">ç¾åœ¨çš„å¿ƒæƒ…åƒä»€éº¼å¤©æ°£ï¼Ÿ</div>
        <div class="mood-tags" id="mood-tags-container">
            </div>
        <div style="margin-top:20px; font-size:0.95rem; color:var(--text-sub); cursor:pointer; letter-spacing:1px; opacity:0.7; transition:0.3s;" class="serif-font" onclick="resetFilter()" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.7">
            é¡¯ç¤ºå…¨éƒ¨åŠŸèƒ½
        </div>
    </section>

    <section class="toolbox-grid" id="toolbox">
        </section>

    <div id="active-feature-container">
        <button class="close-btn" onclick="closeFeature()">é—œé–‰ âœ•</button>
        <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;">
            <h2 id="feature-title-display" class="serif-font" style="text-align: center; font-size: 2.2rem; color: var(--primary); margin-bottom: 20px;">åŠŸèƒ½åç¨±</h2>
            <div id="feature-content-area" style="text-align: center;">
                <p style="font-size: 1.1rem; color: var(--text-sub);">âœ¨ è¼•è¼•åœ°å¸æ°£ï¼Œæ…¢æ…¢åœ°åæ°£ âœ¨</p>
                <p style="font-size: 0.9rem; color: #CCC; margin-top:10px;">(åŠŸèƒ½å»ºç½®ä¸­)</p>
            </div>
        </div>
    </div>

    <script>
        // --- ğŸ§  1. è³‡æ–™åº« (The Brain) ---
        const featuresDB = [
            // Level 1: åŸºç¤å…§å®¹
            { id: 'dbt_cards', name: 'è‡ªæˆ‘ç…§é¡§å¡', icon: 'ğŸƒ', tag: 'DBTç­–ç•¥', moods: ['anxious', 'low', 'numb'], keywords: 'å¡ç‰‡,æŠ½å¡,ç­–ç•¥' },
            { id: 'quotes', name: 'ç™‚ç™’é‡‘å¥', icon: 'ğŸ“œ', tag: 'æ–‡å­—åŠ›é‡', moods: ['low', 'stress'], keywords: 'èªéŒ„,å¥å­,é¼“å‹µ' },
            { id: 'tarot', name: 'å¡”ç¾…æŒ‡å¼•', icon: 'ğŸ”®', tag: 'æ½›æ„è­˜', moods: ['anxious', 'confused'], keywords: 'å¡”ç¾…,å åœ' },
            { id: 'answer_book', name: 'è§£ç­”ä¹‹æ›¸', icon: 'ğŸ“–', tag: 'éˆæ„ŸæŒ‡å¼•', moods: ['confused', 'anxious'], keywords: 'è§£ç­”,å›°æƒ‘,è¿·æƒ˜' }, 
            { id: 'questions', name: 'å•å¥å¼•å°', icon: 'ğŸ’¡', tag: 'è‡ªæˆ‘å°è©±', moods: ['low', 'confused', 'numb'], keywords: 'æ•˜äº‹,sfbt,æ€è€ƒ' }, 
            { id: 'jokes', name: 'ç¬‘è©±æ€¥è½‰å½', icon: 'ğŸ¤£', tag: 'è½‰æ›å¿ƒæƒ…', moods: ['stress', 'low'], keywords: 'ç¬‘è©±,é–‹å¿ƒ' },
            { id: 'animals', name: 'æ¯›å­©ç™‚ç™’', icon: 'ğŸ±', tag: 'è¦–è¦ºå®‰æ’«', moods: ['stress', 'low', 'angry'], keywords: 'è²“,ç‹—,å¯æ„›' },
            { id: 'tasks', name: 'å¾®å°æˆå°±', icon: 'ğŸŒ±', tag: 'è¡Œå‹•', moods: ['numb', 'low'], keywords: 'ä»»å‹™,å‹•åŠ›' },
            
            // Level 2: äº’å‹•å·¥å…·
            { id: 'breathing', name: 'å‘¼å¸ç·´ç¿’', icon: 'ğŸŒ¬ï¸', tag: 'ç”Ÿç†èª¿ç¯€', moods: ['anxious', 'angry', 'panic'], keywords: 'å‘¼å¸,æ”¾é¬†,å†¥æƒ³' },
            { id: 'clicker', name: 'ç´“å£“æ³¡æ³¡', icon: 'ğŸ«§', tag: 'é‡‹æ”¾å£“åŠ›', moods: ['stress', 'angry'], keywords: 'æŒ‰éˆ•,æ³¡æ³¡ç´™' },
            { id: 'whiteboard', name: 'æƒ…ç·’å¡—é´‰', icon: 'ğŸ¨', tag: 'è¡¨é”', moods: ['angry', 'confused', 'numb'], keywords: 'ç•«ç•«,å¯«å­—,ç™½æ¿' },
            { id: 'conveyor', name: 'å¿µé ­è¼¸é€å¸¶', icon: 'ğŸŒŠ', tag: 'ACTè„«é‰¤', moods: ['anxious', 'stress'], keywords: 'å¿µé ­,æƒ³æ³•' },
            { id: 'worry_jar', name: 'ç…©æƒ±å¯„æ”¾', icon: 'ğŸº', tag: 'é‚Šç•Œè¨­å®š', moods: ['anxious', 'stress'], keywords: 'ç…©æƒ±,ç¡ä¸è‘—' },
            { id: 'sos', name: 'å®‰å…¨ç¶² SOS', icon: 'ğŸ†˜', tag: 'å±æ©Ÿæ±‚åŠ©', moods: ['panic', 'low'], keywords: 'æ±‚æ•‘,é›»è©±' }
        ];

        const moodOptions = [
            { id: 'fav', label: 'â¤ï¸ æˆ‘çš„æœ€æ„›', isFav: true },
            { id: 'anxious', label: 'ğŸ˜° ç„¦æ…®æ…Œå¼µ' },
            { id: 'low', label: 'ğŸ˜ ä½è½ç„¡åŠ›' },
            { id: 'angry', label: 'ğŸ˜¡ ç”Ÿæ°£æ†¤æ€’' },
            { id: 'numb', label: 'ğŸ˜¶ éº»æœ¨æ”¾ç©º' },
            { id: 'confused', label: 'ğŸ¤” è¿·æƒ˜å›°æƒ‘' },
            { id: 'panic', label: 'ğŸ†˜ å¿«å´©æ½°äº†' }
        ];

        // è®€å–æœ€æ„›åˆ—è¡¨
        let favorites = JSON.parse(localStorage.getItem('safeSpaceFavs')) || [];

        // --- ğŸ—ï¸ 2. å»ºæ§‹ä»‹é¢ ---
        const toolboxEl = document.getElementById('toolbox');
        const moodContainer = document.getElementById('mood-tags-container');
        const searchInput = document.getElementById('search-input');

        function initApp() {
            renderMoodButtons();
            renderFeatures(featuresDB); 
        }

        // ç”¢ç”Ÿæƒ…ç·’æŒ‰éˆ•
        function renderMoodButtons() {
            moodContainer.innerHTML = '';
            moodOptions.forEach(mood => {
                const btn = document.createElement('button');
                btn.className = 'mood-btn';
                if(mood.isFav) btn.classList.add('fav-filter');
                btn.innerText = mood.label;
                btn.onclick = () => filterByMood(mood.id, btn);
                moodContainer.appendChild(btn);
            });
        }

        // ç”¢ç”Ÿå¡ç‰‡
        function renderFeatures(list) {
            toolboxEl.innerHTML = '';
            
            if (list.length === 0) {
                toolboxEl.innerHTML = `
                    <div class="no-result">
                        <div style="font-size:3rem;">ğŸ‚</div>
                        <br>é€™è£¡æš«æ™‚ç©ºç©ºçš„<br>åƒç§‹å¤©çš„åˆå¾Œ
                    </div>`;
                return;
            }

            list.forEach(feature => {
                const isFav = favorites.includes(feature.id);
                const card = document.createElement('div');
                card.className = 'feature-card';
                card.innerHTML = `
                    <div class="favorite-btn ${isFav ? 'is-active' : ''}" onclick="toggleFavorite(event, '${feature.id}')">
                        ${isFav ? 'â¤ï¸' : 'ğŸ¤'}
                    </div>
                    <div class="card-icon">${feature.icon}</div>
                    <div class="card-title">${feature.name}</div>
                    <div class="card-tag">${feature.tag}</div>
                `;
                card.onclick = (e) => {
                    if(e.target.classList.contains('favorite-btn')) return;
                    openFeature(feature);
                };
                toolboxEl.appendChild(card);
            });
        }

        // --- â¤ï¸ 3. æ„›å¿ƒæ”¶è—é‚è¼¯ ---
        function toggleFavorite(event, id) {
            event.stopPropagation();
            
            if (favorites.includes(id)) {
                favorites = favorites.filter(favId => favId !== id);
            } else {
                favorites.push(id);
            }
            
            localStorage.setItem('safeSpaceFavs', JSON.stringify(favorites));
            
            // æª¢æŸ¥ç›®å‰æ˜¯å¦åœ¨ã€Œæˆ‘çš„æœ€æ„›ã€é é¢ï¼Œå¦‚æœæ˜¯ï¼Œéœ€å³æ™‚é‡ç¹ª
            const activeMoodBtn = document.querySelector('.mood-btn.active');
            if (activeMoodBtn && activeMoodBtn.innerText.includes('æˆ‘çš„æœ€æ„›')) {
                const favList = featuresDB.filter(item => favorites.includes(item.id));
                renderFeatures(favList);
            } else {
                // åŸåœ°æ›´æ–°åœ–ç¤º
                const btn = event.currentTarget;
                const isNowFav = favorites.includes(id);
                btn.innerHTML = isNowFav ? 'â¤ï¸' : 'ğŸ¤';
                btn.classList.toggle('is-active');
            }
        }

        // --- ğŸ§  4. éæ¿¾èˆ‡æœå°‹ ---
        function filterByMood(moodId, clickedBtn) {
            document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('active'));
            clickedBtn.classList.add('active');
            searchInput.value = '';

            if (moodId === 'fav') {
                const favList = featuresDB.filter(item => favorites.includes(item.id));
                renderFeatures(favList);
            } else {
                const filtered = featuresDB.filter(item => item.moods.includes(moodId));
                renderFeatures(filtered);
            }
        }

        searchInput.addEventListener('input', (e) => {
            const keyword = e.target.value.toLowerCase().trim();
            document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('active'));

            if (keyword === '') {
                renderFeatures(featuresDB);
                return;
            }

            const filtered = featuresDB.filter(item => 
                item.name.includes(keyword) || 
                item.keywords.includes(keyword) ||
                item.tag.includes(keyword)
            );
            renderFeatures(filtered);
        });

        function resetFilter() {
            document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('active'));
            searchInput.value = '';
            renderFeatures(featuresDB);
        }

        // --- ğŸ® æ¨¡æ“¬åŠŸèƒ½è¦–çª— ---
        function openFeature(feature) {
            const container = document.getElementById('active-feature-container');
            const title = document.getElementById('feature-title-display');
            container.style.display = 'flex';
            title.innerText = feature.name;
        }

        function closeFeature() {
            document.getElementById('active-feature-container').style.display = 'none';
        }

        initApp();
    </script>
</body>
</html>